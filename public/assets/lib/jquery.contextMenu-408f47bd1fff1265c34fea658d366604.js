/*
 * jQuery contextMenu - Plugin for simple contextMenu handling
 *
 * Version: 1.5.10
 *
 * Authors: Rodney Rehm, Addy Osmani (patches for FF)
 * Web: http://medialize.github.com/jQuery-contextMenu/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
(function(e,t){function v(e){var t=e.split(/\s+/),n=[];for(var r=0,i;i=t[r];r++)i=i[0].toUpperCase(),n.push(i);return n}function m(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function g(n,r,i){i||(i=0),r.each(function(){var r=e(this),s=this,o=this.nodeName.toLowerCase(),u,a;o=="label"&&r.find("input, textarea, select").length&&(u=r.text(),r=r.children().first(),s=r.get(0),o=s.nodeName.toLowerCase());switch(o){case"menu":a={name:r.attr("label"),items:{}},g(a.items,r.children(),i);break;case"a":case"button":a={name:r.text(),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"menuitem":case"command":switch(r.attr("type")){case t:case"command":case"menuitem":a={name:r.attr("label"),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"checkbox":a={type:"checkbox",disabled:!!r.attr("disabled"),name:r.attr("label"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",disabled:!!r.attr("disabled"),name:r.attr("label"),radio:r.attr("radiogroup"),value:r.attr("id"),selected:!!r.attr("checked")};break;default:a=t}break;case"hr":a="-------";break;case"input":switch(r.attr("type")){case"text":a={type:"text",name:u||m(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"checkbox":a={type:"checkbox",name:u||m(s),disabled:!!r.attr("disabled"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",name:u||m(s),disabled:!!r.attr("disabled"),radio:!!r.attr("name"),value:r.val(),selected:!!r.attr("checked")};break;default:a=t}break;case"select":a={type:"select",name:u||m(s),disabled:!!r.attr("disabled"),selected:r.val(),options:{}},r.children().each(function(){a.options[this.value]=e(this).text()});break;case"textarea":a={type:"textarea",name:u||m(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"label":break;default:a={type:"html",html:r.clone(!0)}}a&&(i++,n["key"+i]=a)})}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window;var n=null,r=!1,i=!1,s=e(window),o=0,u={},a={},f={},l={selector:null,appendTo:null,trigger:"right",autoHide:!1,ignoreRightClick:!1,delay:200,determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(t,n,r){var i=this,o;if(!n&&!r){t.determinePosition.call(this,t.$menu);return}if(n==="maintain"&&r==="maintain")o=t.$menu.position();else{var u=t.$trigger.parents().andSelf().filter(function(){return e(this).css("position")=="fixed"}).length;u&&(r-=s.scrollTop(),n-=s.scrollLeft()),o={top:r,left:n}}var a=s.scrollTop()+s.height(),f=s.scrollLeft()+s.width(),l=t.$menu.height(),c=t.$menu.width();o.top+l>a&&(o.top-=l),o.left+c>f&&(o.left-=c),t.$menu.css(o)},positionSubmenu:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display","");else{var n=this.offset();n.top+=0,n.left+=this.outerWidth(),t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},c={timer:null,pageX:null,pageY:null},h=function(e){var t=0,n=e;for(;;){t=Math.max(t,parseInt(n.css("z-index"),10)||0),n=n.parent();if(!n||!n.length||n.prop("nodeName").toLowerCase()=="body")break}return t},p={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var r=e(this);t.preventDefault(),t.stopImmediatePropagation();if(i){i=!1;return}if(!r.hasClass("context-menu-disabled")){n=r;if(t.data.build){var s=t.data.build(n,t);if(s===!1)return;e.extend(!0,t.data,l,s||{});if(!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),new Error("No Items sepcified");d.create(t.data)}d.show.call(r,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(jQuery.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var r=e(this);n&&n.length&&!n.is(r)&&n.data("contextMenu").$menu.trigger("contextmenu:hide"),t.button==2&&(n=r.data("contextMenuActive",!0))},mouseup:function(t){var r=e(this);r.data("contextMenuActive")&&n&&n.length&&n.is(r)&&!r.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),n=r,r.trigger(jQuery.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),r.removeData("contextMenuActive")},mouseenter:function(t){var r=e(this),i=e(t.relatedTarget),s=e(document);if(i.is(".context-menu-list")||i.closest(".context-menu-list").length)return;if(n&&n.length)return;c.pageX=t.pageX,c.pageY=t.pageY,c.data=t.data,s.on("mousemove.contextMenuShow",p.mousemove),c.timer=setTimeout(function(){c.timer=null,s.off("mousemove.contextMenuShow"),n=r,r.trigger(jQuery.Event("contextmenu",{data:c.data,pageX:c.pageX,pageY:c.pageY}))},t.data.delay)},mousemove:function(e){c.pageX=e.pageX,c.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(n.is(".context-menu-list")||n.closest(".context-menu-list").length)return;try{clearTimeout(c.timer)}catch(t){}c.timer=null},ignoreRightClick:function(e){e.button==2&&(i=!0)},layerClick:function(t){var n=e(this),r=n.data("contextMenuRoot");t.preventDefault(),t.stopImmediatePropagation(),n.remove(),r.$menu.trigger("contextmenu:hide"),r.ignoreRightClick&&t.button==2&&(i=!0)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t=n.data("contextMenu")||{},r=t.$menu.children(),i;switch(e.keyCode){case 9:case 38:p.keyStop(e,t);if(t.isInput){if(e.keyCode==9&&e.shiftKey){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("prevcommand");return}if(e.keyCode==38&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}}else if(e.keyCode!=9||e.shiftKey){t.$menu.trigger("prevcommand");return};case 9:case 40:p.keyStop(e,t);if(!t.isInput){t.$menu.trigger("nextcommand");return}if(e.keyCode==9){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("nextcommand");return}if(e.keyCode==40&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}break;case 37:p.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var s=t.$selected.parent().parent();t.$selected.trigger("contextmenu:blur"),t.$selected=s;return}break;case 39:p.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;var o=t.$selected.data("contextMenu")||{};if(o.$menu&&t.$selected.hasClass("context-menu-submenu")){t.$selected=null,o.$selected=null,o.$menu.trigger("nextcommand");return}break;case 35:case 36:if(t.$selected&&t.$selected.find("input, textarea, select").length)return;(t.$selected&&t.$selected.parent()||t.$menu).children(":not(.disabled, .not-selectable)")[e.keyCode==36?"first":"last"]().trigger("contextmenu:focus"),e.preventDefault();return;case 13:p.keyStop(e,t);if(t.isInput){if(t.$selected&&!t.$selected.is("textarea, select")){e.preventDefault();return}break}t.$selected&&t.$selected.trigger("mouseup");return;case 32:case 33:case 34:p.keyStop(e,t);return;case 27:p.keyStop(e,t),t.$menu.trigger("contextmenu:hide");return;default:var u=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys[u]){t.accesskeys[u].$node.trigger(t.accesskeys[u].$menu?"contextmenu:focus":"mouseup");return}}e.stopPropagation(),t.$selected&&t.$selected.trigger(e)},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.prev().length?i.last():n.$selected.prev(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.prev().length?s=s.prev():s=i.last();if(s.is(o))return}n.$selected&&p.itemMouseleave.call(n.$selected.get(0),t),p.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.next().length?i.first():n.$selected.next(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.next().length?s=s.next():s=i.first();if(s.is(o))return}n.$selected&&p.itemMouseleave.call(n.$selected.get(0),t),p.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},focusInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.$selected=i.$selected=n,s.isInput=i.isInput=!0},blurInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.isInput=i.isInput=!1},menuMouseenter:function(t){var n=e(this).data().contextMenuRoot;n.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.hovering=!0,t&&s.$layer&&s.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(i.$menu?i:s).$menu.children(".hover").trigger("contextmenu:blur");if(n.hasClass("disabled")||n.hasClass("not-selectable")){i.$selected=null;return}n.trigger("contextmenu:focus")},itemMouseleave:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;if(s!==i&&s.$layer&&s.$layer.is(t.relatedTarget)){s.$selected&&s.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),s.$selected=i.$selected=i.$node;return}n.trigger("contextmenu:blur")},itemClick:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot,o=r.contextMenuKey,u;if(!i.items[o]||n.hasClass("disabled"))return;t.preventDefault(),t.stopImmediatePropagation();if(e.isFunction(s.callbacks[o]))u=s.callbacks[o];else{if(!e.isFunction(s.callback))return;u=s.callback}u.call(s.$trigger,o,s)!==!1?s.$menu.trigger("contextmenu:hide"):d.update.call(s.$trigger,s)},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t){var n=e(this).data("contextMenuRoot");d.hide.call(n.$trigger,n)},focusItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),i.$selected=s.$selected=n,i.$node&&s.positionSubmenu.call(i.$node,i.$menu)},blurItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.removeClass("hover"),i.$selected=null}},d={show:function(t,r,i){var s=e(this),o,u={};e("#context-menu-layer").trigger("mousedown");if(t.events.show.call(s,t)===!1){n=null;return}t.$trigger=s,d.update.call(s,t),t.position.call(s,t,r,i),t.zIndex&&(u.zIndex=h(s)+t.zIndex),d.layer.call(t.$menu,t,u.zIndex),t.$menu.find("ul").css("zIndex",u.zIndex+1),t.$menu.css(u)[t.animation.show](t.animation.duration),s.data("contextMenu",t),e(document).off("keydown.contextMenu").on("keydown.contextMenu",p.key);if(t.autoHide){var a=s.position();a.right=a.left+s.outerWidth(),a.bottom=a.top+this.outerHeight(),e(document).on("mousemove.contextMenuAutoHide",function(e){t.$layer&&!t.hovering&&(!(e.pageX>=a.left&&e.pageX<=a.right)||!(e.pageY>=a.top&&e.pageY<=a.bottom))&&t.$layer.trigger("mousedown")})}},hide:function(r){var i=e(this);r||(r=i.data("contextMenu")||{});if(r.events&&r.events.hide.call(i,r)===!1)return;if(r.$layer)try{r.$layer.remove(),delete r.$layer}catch(s){r.$layer=null}n=null,r.$menu.find(".hover").trigger("contextmenu:blur"),r.$selected=null,e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),r.$menu&&r.$menu[r.animation.hide](r.animation.duration),r.build&&(r.$menu.remove(),e.each(r,function(e,n){switch(e){case"ns":case"selector":case"build":case"trigger":case"ignoreRightClick":return!0;default:r[e]=t;try{delete r[e]}catch(i){}return!0}}))},create:function(n,r){r===t&&(r=n),n.$menu=e('<ul class="context-menu-list '+(n.className||"")+'"></ul>').data({contextMenu:n,contextMenuRoot:r}),e.each(["callbacks","commands","inputs"],function(e,t){n[t]={},r[t]||(r[t]={})}),r.accesskeys||(r.accesskeys={}),e.each(n.items,function(t,i){var s=e('<li class="context-menu-item '+(i.className||"")+'"></li>'),o=null,u=null;i.$node=s.data({contextMenu:n,contextMenuRoot:r,contextMenuKey:t});if(i.accesskey){var a=v(i.accesskey);for(var l=0,c;c=a[l];l++)if(!r.accesskeys[c]){r.accesskeys[c]=i,i._name=i.name.replace(new RegExp("("+c+")","i"),'<span class="context-menu-accesskey">$1</span>');break}}if(typeof i=="string")s.addClass("context-menu-separator not-selectable");else if(i.type&&f[i.type])f[i.type].call(s,i,n,r),e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)});else{i.type=="html"?s.addClass("context-menu-html not-selectable"):i.type?(o=e("<label></label>").appendTo(s),e("<span></span>").html(i._name||i.name).appendTo(o),s.addClass("context-menu-input"),n.hasTypes=!0,e.each([n,r],function(e,n){n.commands[t]=i,n.inputs[t]=i})):i.items&&(i.type="sub");switch(i.type){case"text":u=e('<input type="text" value="1" name="context-menu-input-'+t+'" value="">').val(i.value||"").appendTo(o);break;case"textarea":u=e('<textarea name="context-menu-input-'+t+'"></textarea>').val(i.value||"").appendTo(o),i.height&&u.height(i.height);break;case"checkbox":u=e('<input type="checkbox" value="1" name="context-menu-input-'+t+'" value="">').val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"radio":u=e('<input type="radio" value="1" name="context-menu-input-'+i.radio+'" value="">').val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"select":u=e('<select name="context-menu-input-'+t+'">').appendTo(o),i.options&&(e.each(i.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(u)}),u.val(i.selected));break;case"sub":e("<span></span>").html(i._name||i.name).appendTo(s),i.appendTo=i.$node,d.create(i,r),s.data("contextMenu",i).addClass("context-menu-submenu"),i.callback=null;break;case"html":e(i.html).appendTo(s);break;default:e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)}),e("<span></span>").html(i._name||i.name||"").appendTo(s)}i.type&&i.type!="sub"&&i.type!="html"&&(u.on("focus",p.focusInput).on("blur",p.blurInput),i.events&&u.on(i.events)),i.icon&&s.addClass("icon icon-"+i.icon)}i.$input=u,i.$label=o,s.appendTo(n.$menu),n.hasTypes||(e.browser.msie?s.on("selectstart.disableTextSelect",p.abortevent):e.browser.mozilla||s.on("mousedown.disableTextSelect",p.abortevent))}),n.$node||n.$menu.css("display","none").addClass("context-menu-root"),n.$menu.appendTo(n.appendTo||document.body)},update:function(n,r){var i=this;r===t&&(r=n,n.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var t=e(this);t.width(t.css("position","absolute").width()).css("position","static")}).css({position:"",display:""})),n.$menu.children().each(function(){var t=e(this),s=t.data("contextMenuKey"),o=n.items[s],u=e.isFunction(o.disabled)&&o.disabled.call(i,s,r)||o.disabled===!0;t[u?"addClass":"removeClass"]("disabled");if(o.type){t.find("input, select, textarea").prop("disabled",u);switch(o.type){case"text":case"textarea":o.$input.val(o.value||"");break;case"checkbox":case"radio":o.$input.val(o.value||"").prop("checked",!!o.selected);break;case"select":o.$input.val(o.selected||"")}}o.$menu&&d.update.call(i,o,r)})},layer:function(t,n){return t.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+n+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:s.height(),width:s.width(),display:"block"}).data("contextMenuRoot",t).insertBefore(this).on("mousedown",p.layerClick)}};e.fn.contextMenu=function(e){if(e===t)this.first().trigger("contextmenu");else if(e.x&&e.y)this.first().trigger(jQuery.Event("contextmenu",{pageX:e.x,pageY:e.y}));else if(e==="hide"){var n=this.data("contextMenu").$menu;n&&n.trigger("contextmenu:hide")}else e?this.removeClass("context-menu-disabled"):e||this.addClass("context-menu-disabled");return this},e.contextMenu=function(n,i){typeof n!="string"&&(i=n,n="create"),typeof i=="string"?i={selector:i}:i===t&&(i={});var s=e.extend(!0,{},l,i||{}),f=f=e(document);switch(n){case"create":if(!s.selector)throw new Error("No selector specified");if(s.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+s.selector+'" as it contains a reserved className');if(!s.build&&(!s.items||e.isEmptyObject(s.items)))throw new Error("No Items sepcified");o++,s.ns=".contextMenu"+o,u[s.selector]=s.ns,a[s.ns]=s,r||(f.on({"contextmenu:hide.contextMenu":p.hideMenu,"prevcommand.contextMenu":p.prevItem,"nextcommand.contextMenu":p.nextItem,"contextmenu.contextMenu":p.abortevent,"mouseenter.contextMenu":p.menuMouseenter,"mouseleave.contextMenu":p.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",p.inputClick).on({"mouseup.contextMenu":p.itemClick,"contextmenu:focus.contextMenu":p.focusItem,"contextmenu:blur.contextMenu":p.blurItem,"contextmenu.contextMenu":p.abortevent,"mouseenter.contextMenu":p.itemMouseenter,"mouseleave.contextMenu":p.itemMouseleave},".context-menu-item"),r=!0),f.on("contextmenu"+s.ns,s.selector,s,p.contextmenu);switch(s.trigger){case"hover":f.on("mouseenter"+s.ns,s.selector,s,p.mouseenter).on("mouseleave"+s.ns,s.selector,s,p.mouseleave);break;case"left":f.on("click"+s.ns,s.selector,s,p.click)}s.trigger!="hover"&&s.ignoreRightClick&&f.on("mousedown"+s.ns,s.selector,p.ignoreRightClick),s.build||d.create(s);break;case"destroy":if(!s.selector)f.off(".contextMenu .contextMenuAutoHide"),e.each(u,function(e,t){f.off(t)}),u={},a={},o=0,r=!1,e(".context-menu-list").remove();else if(u[s.selector]){try{a[u[s.selector]].$menu&&a[u[s.selector]].$menu.remove(),delete a[u[s.selector]]}catch(c){a[u[s.selector]]=null}f.off(u[s.selector])}break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||typeof i=="boolean"&&i)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+n+'"')}return this},e.contextMenu.setInputValues=function(n,r){r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=r[e]||"";break;case"checkbox":t.selected=r[e]?!0:!1;break;case"radio":t.selected=(r[t.radio]||"")==t.value?!0:!1;break;case"select":t.selected=r[e]||""}})},e.contextMenu.getInputValues=function(n,r){return r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":r[e]=t.$input.val();break;case"checkbox":r[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(r[t.radio]=t.value)}}),r},e.contextMenu.fromMenu=function(t){var n=e(t),r={};return g(r,n.children()),r},e.contextMenu.defaults=l,e.contextMenu.types=f})(jQuery);