/*
 * jQuery contextMenu - Plugin for simple contextMenu handling
 *
 * Version: 1.5.10
 *
 * Authors: Rodney Rehm, Addy Osmani (patches for FF)
 * Web: http://medialize.github.com/jQuery-contextMenu/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
(function(a,b){function p(a){var b=a.split(/\s+/),c=[];for(var d=0,e;e=b[d];d++)e=e[0].toUpperCase(),c.push(e);return c}function q(b){return b.id&&a('label[for="'+b.id+'"]').val()||b.name}function r(c,d,e){e||(e=0),d.each(function(){var d=a(this),f=this,g=this.nodeName.toLowerCase(),h,i;g=="label"&&d.find("input, textarea, select").length&&(h=d.text(),d=d.children().first(),f=d.get(0),g=f.nodeName.toLowerCase());switch(g){case"menu":i={name:d.attr("label"),items:{}},r(i.items,d.children(),e);break;case"a":case"button":i={name:d.text(),disabled:!!d.attr("disabled"),callback:function(){return function(){d.click()}}()};break;case"menuitem":case"command":switch(d.attr("type")){case b:case"command":case"menuitem":i={name:d.attr("label"),disabled:!!d.attr("disabled"),callback:function(){return function(){d.click()}}()};break;case"checkbox":i={type:"checkbox",disabled:!!d.attr("disabled"),name:d.attr("label"),selected:!!d.attr("checked")};break;case"radio":i={type:"radio",disabled:!!d.attr("disabled"),name:d.attr("label"),radio:d.attr("radiogroup"),value:d.attr("id"),selected:!!d.attr("checked")};break;default:i=b}break;case"hr":i="-------";break;case"input":switch(d.attr("type")){case"text":i={type:"text",name:h||q(f),disabled:!!d.attr("disabled"),value:d.val()};break;case"checkbox":i={type:"checkbox",name:h||q(f),disabled:!!d.attr("disabled"),selected:!!d.attr("checked")};break;case"radio":i={type:"radio",name:h||q(f),disabled:!!d.attr("disabled"),radio:!!d.attr("name"),value:d.val(),selected:!!d.attr("checked")};break;default:i=b}break;case"select":i={type:"select",name:h||q(f),disabled:!!d.attr("disabled"),selected:d.val(),options:{}},d.children().each(function(){i.options[this.value]=a(this).text()});break;case"textarea":i={type:"textarea",name:h||q(f),disabled:!!d.attr("disabled"),value:d.val()};break;case"label":break;default:i={type:"html",html:d.clone(!0)}}i&&(e++,c["key"+e]=i)})}a.support.htmlMenuitem="HTMLMenuItemElement"in window,a.support.htmlCommand="HTMLCommandElement"in window;var c=null,d=!1,e=!1,f=a(window),g=0,h={},i={},j={},k={selector:null,appendTo:null,trigger:"right",autoHide:!1,ignoreRightClick:!1,delay:200,determinePosition:function(b){if(a.ui&&a.ui.position)b.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var c=this.offset();c.top+=this.outerHeight(),c.left+=this.outerWidth()/2-b.outerWidth()/2,b.css(c)}},position:function(b,c,d){var e=this,g;if(!c&&!d){b.determinePosition.call(this,b.$menu);return}if(c==="maintain"&&d==="maintain")g=b.$menu.position();else{var h=b.$trigger.parents().andSelf().filter(function(){return a(this).css("position")=="fixed"}).length;h&&(d-=f.scrollTop(),c-=f.scrollLeft()),g={top:d,left:c}}var i=f.scrollTop()+f.height(),j=f.scrollLeft()+f.width(),k=b.$menu.height(),l=b.$menu.width();g.top+k>i&&(g.top-=k),g.left+l>j&&(g.left-=l),b.$menu.css(g)},positionSubmenu:function(b){if(a.ui&&a.ui.position)b.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display","");else{var c=this.offset();c.top+=0,c.left+=this.outerWidth(),b.css(c)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:a.noop,hide:a.noop},callback:null,items:{}},l={timer:null,pageX:null,pageY:null},m=function(a){var b=0,c=a;for(;;){b=Math.max(b,parseInt(c.css("z-index"),10)||0),c=c.parent();if(!c||!c.length||c.prop("nodeName").toLowerCase()=="body")break}return b},n={abortevent:function(a){a.preventDefault(),a.stopImmediatePropagation()},contextmenu:function(b){var d=a(this);b.preventDefault(),b.stopImmediatePropagation();if(e){e=!1;return}if(!d.hasClass("context-menu-disabled")){c=d;if(b.data.build){var f=b.data.build(c,b);if(f===!1)return;a.extend(!0,b.data,k,f||{});if(!b.data.items||a.isEmptyObject(b.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),new Error("No Items sepcified");o.create(b.data)}o.show.call(d,b.data,b.pageX,b.pageY)}},click:function(b){b.preventDefault(),b.stopImmediatePropagation(),a(this).trigger(jQuery.Event("contextmenu",{data:b.data,pageX:b.pageX,pageY:b.pageY}))},mousedown:function(b){var d=a(this);c&&c.length&&!c.is(d)&&c.data("contextMenu").$menu.trigger("contextmenu:hide"),b.button==2&&(c=d.data("contextMenuActive",!0))},mouseup:function(b){var d=a(this);d.data("contextMenuActive")&&c&&c.length&&c.is(d)&&!d.hasClass("context-menu-disabled")&&(b.preventDefault(),b.stopImmediatePropagation(),c=d,d.trigger(jQuery.Event("contextmenu",{data:b.data,pageX:b.pageX,pageY:b.pageY}))),d.removeData("contextMenuActive")},mouseenter:function(b){var d=a(this),e=a(b.relatedTarget),f=a(document);if(e.is(".context-menu-list")||e.closest(".context-menu-list").length)return;if(c&&c.length)return;l.pageX=b.pageX,l.pageY=b.pageY,l.data=b.data,f.on("mousemove.contextMenuShow",n.mousemove),l.timer=setTimeout(function(){l.timer=null,f.off("mousemove.contextMenuShow"),c=d,d.trigger(jQuery.Event("contextmenu",{data:l.data,pageX:l.pageX,pageY:l.pageY}))},b.data.delay)},mousemove:function(a){l.pageX=a.pageX,l.pageY=a.pageY},mouseleave:function(b){var c=a(b.relatedTarget);if(c.is(".context-menu-list")||c.closest(".context-menu-list").length)return;try{clearTimeout(l.timer)}catch(b){}l.timer=null},ignoreRightClick:function(a){a.button==2&&(e=!0)},layerClick:function(b){var c=a(this),d=c.data("contextMenuRoot");b.preventDefault(),b.stopImmediatePropagation(),c.remove(),d.$menu.trigger("contextmenu:hide"),d.ignoreRightClick&&b.button==2&&(e=!0)},keyStop:function(a,b){b.isInput||a.preventDefault(),a.stopPropagation()},key:function(a){var b=c.data("contextMenu")||{},d=b.$menu.children(),e;switch(a.keyCode){case 9:case 38:n.keyStop(a,b);if(b.isInput){if(a.keyCode==9&&a.shiftKey){a.preventDefault(),b.$selected&&b.$selected.find("input, textarea, select").blur(),b.$menu.trigger("prevcommand");return}if(a.keyCode==38&&b.$selected.find("input, textarea, select").prop("type")=="checkbox"){a.preventDefault();return}}else if(a.keyCode!=9||a.shiftKey){b.$menu.trigger("prevcommand");return};case 9:case 40:n.keyStop(a,b);if(!b.isInput){b.$menu.trigger("nextcommand");return}if(a.keyCode==9){a.preventDefault(),b.$selected&&b.$selected.find("input, textarea, select").blur(),b.$menu.trigger("nextcommand");return}if(a.keyCode==40&&b.$selected.find("input, textarea, select").prop("type")=="checkbox"){a.preventDefault();return}break;case 37:n.keyStop(a,b);if(b.isInput||!b.$selected||!b.$selected.length)break;if(!b.$selected.parent().hasClass("context-menu-root")){var f=b.$selected.parent().parent();b.$selected.trigger("contextmenu:blur"),b.$selected=f;return}break;case 39:n.keyStop(a,b);if(b.isInput||!b.$selected||!b.$selected.length)break;var g=b.$selected.data("contextMenu")||{};if(g.$menu&&b.$selected.hasClass("context-menu-submenu")){b.$selected=null,g.$selected=null,g.$menu.trigger("nextcommand");return}break;case 35:case 36:if(b.$selected&&b.$selected.find("input, textarea, select").length)return;(b.$selected&&b.$selected.parent()||b.$menu).children(":not(.disabled, .not-selectable)")[a.keyCode==36?"first":"last"]().trigger("contextmenu:focus"),a.preventDefault();return;case 13:n.keyStop(a,b);if(b.isInput){if(b.$selected&&!b.$selected.is("textarea, select")){a.preventDefault();return}break}b.$selected&&b.$selected.trigger("mouseup");return;case 32:case 33:case 34:n.keyStop(a,b);return;case 27:n.keyStop(a,b),b.$menu.trigger("contextmenu:hide");return;default:var h=String.fromCharCode(a.keyCode).toUpperCase();if(b.accesskeys[h]){b.accesskeys[h].$node.trigger(b.accesskeys[h].$menu?"contextmenu:focus":"mouseup");return}}a.stopPropagation(),b.$selected&&b.$selected.trigger(a)},prevItem:function(b){b.stopPropagation();var c=a(this).data("contextMenu")||{};if(c.$selected){var d=c.$selected;c=c.$selected.parent().data("contextMenu")||{},c.$selected=d}var e=c.$menu.children(),f=!c.$selected||!c.$selected.prev().length?e.last():c.$selected.prev(),g=f;while(f.hasClass("disabled")||f.hasClass("not-selectable")){f.prev().length?f=f.prev():f=e.last();if(f.is(g))return}c.$selected&&n.itemMouseleave.call(c.$selected.get(0),b),n.itemMouseenter.call(f.get(0),b);var h=f.find("input, textarea, select");h.length&&h.focus()},nextItem:function(b){b.stopPropagation();var c=a(this).data("contextMenu")||{};if(c.$selected){var d=c.$selected;c=c.$selected.parent().data("contextMenu")||{},c.$selected=d}var e=c.$menu.children(),f=!c.$selected||!c.$selected.next().length?e.first():c.$selected.next(),g=f;while(f.hasClass("disabled")||f.hasClass("not-selectable")){f.next().length?f=f.next():f=e.first();if(f.is(g))return}c.$selected&&n.itemMouseleave.call(c.$selected.get(0),b),n.itemMouseenter.call(f.get(0),b);var h=f.find("input, textarea, select");h.length&&h.focus()},focusInput:function(b){var c=a(this).closest(".context-menu-item"),d=c.data(),e=d.contextMenu,f=d.contextMenuRoot;f.$selected=e.$selected=c,f.isInput=e.isInput=!0},blurInput:function(b){var c=a(this).closest(".context-menu-item"),d=c.data(),e=d.contextMenu,f=d.contextMenuRoot;f.isInput=e.isInput=!1},menuMouseenter:function(b){var c=a(this).data().contextMenuRoot;c.hovering=!0},menuMouseleave:function(b){var c=a(this).data().contextMenuRoot;c.$layer&&c.$layer.is(b.relatedTarget)&&(c.hovering=!1)},itemMouseenter:function(b){var c=a(this),d=c.data(),e=d.contextMenu,f=d.contextMenuRoot;f.hovering=!0,b&&f.$layer&&f.$layer.is(b.relatedTarget)&&(b.preventDefault(),b.stopImmediatePropagation()),(e.$menu?e:f).$menu.children(".hover").trigger("contextmenu:blur");if(c.hasClass("disabled")||c.hasClass("not-selectable")){e.$selected=null;return}c.trigger("contextmenu:focus")},itemMouseleave:function(b){var c=a(this),d=c.data(),e=d.contextMenu,f=d.contextMenuRoot;if(f!==e&&f.$layer&&f.$layer.is(b.relatedTarget)){f.$selected&&f.$selected.trigger("contextmenu:blur"),b.preventDefault(),b.stopImmediatePropagation(),f.$selected=e.$selected=e.$node;return}c.trigger("contextmenu:blur")},itemClick:function(b){var c=a(this),d=c.data(),e=d.contextMenu,f=d.contextMenuRoot,g=d.contextMenuKey,h;if(!e.items[g]||c.hasClass("disabled"))return;b.preventDefault(),b.stopImmediatePropagation();if(a.isFunction(f.callbacks[g]))h=f.callbacks[g];else{if(!a.isFunction(f.callback))return;h=f.callback}h.call(f.$trigger,g,f)!==!1?f.$menu.trigger("contextmenu:hide"):o.update.call(f.$trigger,f)},inputClick:function(a){a.stopImmediatePropagation()},hideMenu:function(b){var c=a(this).data("contextMenuRoot");o.hide.call(c.$trigger,c)},focusItem:function(b){b.stopPropagation();var c=a(this),d=c.data(),e=d.contextMenu,f=d.contextMenuRoot;c.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),e.$selected=f.$selected=c,e.$node&&f.positionSubmenu.call(e.$node,e.$menu)},blurItem:function(b){b.stopPropagation();var c=a(this),d=c.data(),e=d.contextMenu,f=d.contextMenuRoot;c.removeClass("hover"),e.$selected=null}},o={show:function(b,d,e){var f=a(this),g,h={};a("#context-menu-layer").trigger("mousedown");if(b.events.show.call(f,b)===!1){c=null;return}b.$trigger=f,o.update.call(f,b),b.position.call(f,b,d,e),b.zIndex&&(h.zIndex=m(f)+b.zIndex),o.layer.call(b.$menu,b,h.zIndex),b.$menu.find("ul").css("zIndex",h.zIndex+1),b.$menu.css(h)[b.animation.show](b.animation.duration),f.data("contextMenu",b),a(document).off("keydown.contextMenu").on("keydown.contextMenu",n.key);if(b.autoHide){var i=f.position();i.right=i.left+f.outerWidth(),i.bottom=i.top+this.outerHeight(),a(document).on("mousemove.contextMenuAutoHide",function(a){b.$layer&&!b.hovering&&(!(a.pageX>=i.left&&a.pageX<=i.right)||!(a.pageY>=i.top&&a.pageY<=i.bottom))&&b.$layer.trigger("mousedown")})}},hide:function(d){var e=a(this);d||(d=e.data("contextMenu")||{});if(d.events&&d.events.hide.call(e,d)===!1)return;if(d.$layer)try{d.$layer.remove(),delete d.$layer}catch(f){d.$layer=null}c=null,d.$menu.find(".hover").trigger("contextmenu:blur"),d.$selected=null,a(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),d.$menu&&d.$menu[d.animation.hide](d.animation.duration),d.build&&(d.$menu.remove(),a.each(d,function(a,c){switch(a){case"ns":case"selector":case"build":case"trigger":case"ignoreRightClick":return!0;default:d[a]=b;try{delete d[a]}catch(e){}return!0}}))},create:function(c,d){d===b&&(d=c),c.$menu=a('<ul class="context-menu-list '+(c.className||"")+'"></ul>').data({contextMenu:c,contextMenuRoot:d}),a.each(["callbacks","commands","inputs"],function(a,b){c[b]={},d[b]||(d[b]={})}),d.accesskeys||(d.accesskeys={}),a.each(c.items,function(b,e){var f=a('<li class="context-menu-item '+(e.className||"")+'"></li>'),g=null,h=null;e.$node=f.data({contextMenu:c,contextMenuRoot:d,contextMenuKey:b});if(e.accesskey){var i=p(e.accesskey);for(var k=0,l;l=i[k];k++)if(!d.accesskeys[l]){d.accesskeys[l]=e,e._name=e.name.replace(new RegExp("("+l+")","i"),'<span class="context-menu-accesskey">$1</span>');break}}if(typeof e=="string")f.addClass("context-menu-separator not-selectable");else if(e.type&&j[e.type])j[e.type].call(f,e,c,d),a.each([c,d],function(c,d){d.commands[b]=e,a.isFunction(e.callback)&&(d.callbacks[b]=e.callback)});else{e.type=="html"?f.addClass("context-menu-html not-selectable"):e.type?(g=a("<label></label>").appendTo(f),a("<span></span>").html(e._name||e.name).appendTo(g),f.addClass("context-menu-input"),c.hasTypes=!0,a.each([c,d],function(a,c){c.commands[b]=e,c.inputs[b]=e})):e.items&&(e.type="sub");switch(e.type){case"text":h=a('<input type="text" value="1" name="context-menu-input-'+b+'" value="">').val(e.value||"").appendTo(g);break;case"textarea":h=a('<textarea name="context-menu-input-'+b+'"></textarea>').val(e.value||"").appendTo(g),e.height&&h.height(e.height);break;case"checkbox":h=a('<input type="checkbox" value="1" name="context-menu-input-'+b+'" value="">').val(e.value||"").prop("checked",!!e.selected).prependTo(g);break;case"radio":h=a('<input type="radio" value="1" name="context-menu-input-'+e.radio+'" value="">').val(e.value||"").prop("checked",!!e.selected).prependTo(g);break;case"select":h=a('<select name="context-menu-input-'+b+'">').appendTo(g),e.options&&(a.each(e.options,function(b,c){a("<option></option>").val(b).text(c).appendTo(h)}),h.val(e.selected));break;case"sub":a("<span></span>").html(e._name||e.name).appendTo(f),e.appendTo=e.$node,o.create(e,d),f.data("contextMenu",e).addClass("context-menu-submenu"),e.callback=null;break;case"html":a(e.html).appendTo(f);break;default:a.each([c,d],function(c,d){d.commands[b]=e,a.isFunction(e.callback)&&(d.callbacks[b]=e.callback)}),a("<span></span>").html(e._name||e.name||"").appendTo(f)}e.type&&e.type!="sub"&&e.type!="html"&&(h.on("focus",n.focusInput).on("blur",n.blurInput),e.events&&h.on(e.events)),e.icon&&f.addClass("icon icon-"+e.icon)}e.$input=h,e.$label=g,f.appendTo(c.$menu),c.hasTypes||(a.browser.msie?f.on("selectstart.disableTextSelect",n.abortevent):a.browser.mozilla||f.on("mousedown.disableTextSelect",n.abortevent))}),c.$node||c.$menu.css("display","none").addClass("context-menu-root"),c.$menu.appendTo(c.appendTo||document.body)},update:function(c,d){var e=this;d===b&&(d=c,c.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var b=a(this);b.width(b.css("position","absolute").width()).css("position","static")}).css({position:"",display:""})),c.$menu.children().each(function(){var b=a(this),f=b.data("contextMenuKey"),g=c.items[f],h=a.isFunction(g.disabled)&&g.disabled.call(e,f,d)||g.disabled===!0;b[h?"addClass":"removeClass"]("disabled");if(g.type){b.find("input, select, textarea").prop("disabled",h);switch(g.type){case"text":case"textarea":g.$input.val(g.value||"");break;case"checkbox":case"radio":g.$input.val(g.value||"").prop("checked",!!g.selected);break;case"select":g.$input.val(g.selected||"")}}g.$menu&&o.update.call(e,g,d)})},layer:function(b,c){return b.$layer=a('<div id="context-menu-layer" style="position:fixed; z-index:'+c+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:f.height(),width:f.width(),display:"block"}).data("contextMenuRoot",b).insertBefore(this).on("mousedown",n.layerClick)}};a.fn.contextMenu=function(a){if(a===b)this.first().trigger("contextmenu");else if(a.x&&a.y)this.first().trigger(jQuery.Event("contextmenu",{pageX:a.x,pageY:a.y}));else if(a==="hide"){var c=this.data("contextMenu").$menu;c&&c.trigger("contextmenu:hide")}else a?this.removeClass("context-menu-disabled"):a||this.addClass("context-menu-disabled");return this},a.contextMenu=function(c,e){typeof c!="string"&&(e=c,c="create"),typeof e=="string"?e={selector:e}:e===b&&(e={});var f=a.extend(!0,{},k,e||{}),j=j=a(document);switch(c){case"create":if(!f.selector)throw new Error("No selector specified");if(f.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+f.selector+'" as it contains a reserved className');if(!f.build&&(!f.items||a.isEmptyObject(f.items)))throw new Error("No Items sepcified");g++,f.ns=".contextMenu"+g,h[f.selector]=f.ns,i[f.ns]=f,d||(j.on({"contextmenu:hide.contextMenu":n.hideMenu,"prevcommand.contextMenu":n.prevItem,"nextcommand.contextMenu":n.nextItem,"contextmenu.contextMenu":n.abortevent,"mouseenter.contextMenu":n.menuMouseenter,"mouseleave.contextMenu":n.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",n.inputClick).on({"mouseup.contextMenu":n.itemClick,"contextmenu:focus.contextMenu":n.focusItem,"contextmenu:blur.contextMenu":n.blurItem,"contextmenu.contextMenu":n.abortevent,"mouseenter.contextMenu":n.itemMouseenter,"mouseleave.contextMenu":n.itemMouseleave},".context-menu-item"),d=!0),j.on("contextmenu"+f.ns,f.selector,f,n.contextmenu);switch(f.trigger){case"hover":j.on("mouseenter"+f.ns,f.selector,f,n.mouseenter).on("mouseleave"+f.ns,f.selector,f,n.mouseleave);break;case"left":j.on("click"+f.ns,f.selector,f,n.click)}f.trigger!="hover"&&f.ignoreRightClick&&j.on("mousedown"+f.ns,f.selector,n.ignoreRightClick),f.build||o.create(f);break;case"destroy":if(!f.selector)j.off(".contextMenu .contextMenuAutoHide"),a.each(h,function(a,b){j.off(b)}),h={},i={},g=0,d=!1,a(".context-menu-list").remove();else if(h[f.selector]){try{i[h[f.selector]].$menu&&i[h[f.selector]].$menu.remove(),delete i[h[f.selector]]}catch(l){i[h[f.selector]]=null}j.off(h[f.selector])}break;case"html5":(!a.support.htmlCommand&&!a.support.htmlMenuitem||typeof e=="boolean"&&e)&&a('menu[type="context"]').each(function(){this.id&&a.contextMenu({selector:"[contextmenu="+this.id+"]",items:a.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+c+'"')}return this},a.contextMenu.setInputValues=function(c,d){d===b&&(d={}),a.each(c.inputs,function(a,b){switch(b.type){case"text":case"textarea":b.value=d[a]||"";break;case"checkbox":b.selected=d[a]?!0:!1;break;case"radio":b.selected=(d[b.radio]||"")==b.value?!0:!1;break;case"select":b.selected=d[a]||""}})},a.contextMenu.getInputValues=function(c,d){return d===b&&(d={}),a.each(c.inputs,function(a,b){switch(b.type){case"text":case"textarea":case"select":d[a]=b.$input.val();break;case"checkbox":d[a]=b.$input.prop("checked");break;case"radio":b.$input.prop("checked")&&(d[b.radio]=b.value)}}),d},a.contextMenu.fromMenu=function(b){var c=a(b),d={};return r(d,c.children()),d},a.contextMenu.defaults=k,a.contextMenu.types=j})(jQuery);