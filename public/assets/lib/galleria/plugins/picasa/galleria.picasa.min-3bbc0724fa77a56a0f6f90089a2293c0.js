/*
 Galleria Picasa Plugin 2011-08-01
 http://galleria.aino.se

 Copyright 2011, Aino
 Licensed under the MIT license.
*/
Galleria.requires(1.25,"The Picasa Plugin requires Galleria version 1.2.5 or later."),function(e){var t=Galleria.utils.getScriptPath();Galleria.Picasa=function(){this.options={max:30,imageSize:"medium",thumbSize:"thumb",description:!1,complete:function(){}}},Galleria.Picasa.prototype={constructor:Galleria.Picasa,search:function(e,t){return this._call("search","all",{q:e},t)},user:function(e,t){return this._call("user","user/"+e,t)},useralbum:function(e,t,n){return this._call("useralbum","user/"+e+"/album/"+t,n)},setOptions:function(t){return e.extend(this.options,t),this},_call:function(t,n,r,i){n="https://picasaweb.google.com/data/feed/api/"+n+"?",typeof r=="function"&&(i=r,r={});var s=this,r=e.extend({kind:"photo",access:"public","max-results":this.options.max,thumbsize:this._getSizes().join(","),alt:"json-in-script",callback:"?"},r);e.each(r,function(e,t){n+="&"+e+"="+t});var o=!1;return Galleria.utils.wait({until:function(){return o},success:function(){s._parse.call(s,o.feed.entry,i)},error:function(){var e="";t=="user"?e="user not found.":t=="useralbum"&&(e="album or user not found."),Galleria.raise("Picasa request failed"+(e?": "+e:"."))},timeout:5e3}),e.getJSON(n,function(e){o=e}),s},_getSizes:function(){var t={small:"72c",thumb:"104u",medium:"640u",big:"1024u",original:"1600u"},n=this.options,r={},i,s=[32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600];return e(["thumbSize","imageSize"]).each(function(){n[this]in t?r[this]=t[n[this]]:(i=Galleria.utils.parseValue(n[this]),i>1600?i=1600:e.each(s,function(e){if(i<this)return i=s[e-1],!1}),r[this]=i)}),[r.thumbSize,r.imageSize,"1280u"]},_parse:function(t,n){var r=this,i=[],s;e.each(t,function(){s=this.media$group.media$thumbnail,i.push({thumb:s[0].url,image:s[1].url,big:s[2].url,title:this.title.$t,description:r.options.description?this.summary.$t:""})}),n.call(this,i)}};var n=Galleria.prototype.load;Galleria.prototype.load=function(){if(arguments.length||typeof this._options.picasa!="string")n.apply(this,Galleria.utils.array(arguments));else{var r=this,s=Galleria.utils.array(arguments),o=this._options.picasa.split(":"),u,a=e.extend({},r._options.picasaOptions),l=typeof a.loader!="undefined"?a.loader:e("<div>").css({width:48,height:48,opacity:.7,background:"#000 url("+t+"loader.gif) no-repeat 50% 50%"});if(o.length){if(typeof Galleria.Picasa.prototype[o[0]]!="function")return Galleria.raise(o[0]+" method not found in Picasa plugin"),n.apply(this,s);if(!o[1])return Galleria.raise("No picasa argument found"),n.apply(this,s);window.setTimeout(function(){r.$("target").append(l)},100),u=new Galleria.Picasa,typeof r._options.picasaOptions=="object"&&u.setOptions(r._options.picasaOptions),s=[];if(o[0]=="useralbum"){if(s=o[1].split("/"),s.length!=2){Galleria.raise("Picasa useralbum not correctly formatted (should be [user]/[album])");return}}else s.push(o[1]);s.push(function(e){r._data=e,l.remove(),r.trigger(Galleria.DATA),u.options.complete.call(u,e)}),u[o[0]].apply(u,s)}else n.apply(this,s)}}}(jQuery);