/**
 * @preserve Galleria v 1.2.6 2011-12-12
 * http://galleria.aino.se
 *
 * Copyright (c) 2011, Aino
 * Licensed under the MIT license.
 */
/*global jQuery, navigator, Galleria:true, Image */
(function(e){var t,n=this,r=n.document,i=e(r),s=e(n),o=1.26,u=!0,a=3e4,f=!1,l=navigator.userAgent.toLowerCase(),c=n.location.hash.replace(/#\//,""),h=function(){var e=3,n=r.createElement("div"),i=n.getElementsByTagName("i");do n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->";while(i[0]);return e>4?e:t}(),p=function(){return{html:r.documentElement,body:r.body,head:r.getElementsByTagName("head")[0],title:r.title}},d="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",v=function(){var t=[];return e.each(d.split(" "),function(e,n){t.push(n),/_/.test(n)&&t.push(n.replace(/_/g,""))}),t}(),m=function(t){var n;return typeof t!="object"?t:(e.each(t,function(r,i){/^[a-z]+_/.test(r)&&(n="",e.each(r.split("_"),function(e,t){n+=e>0?t.substr(0,1).toUpperCase()+t.substr(1):t}),t[n]=i,delete t[r])}),t)},g=function(t){return e.inArray(t,v)>-1?Galleria[t.toUpperCase()]:t},y={trunk:{},add:function(e,t,r,i){i=i||!1,this.clear(e);if(i){var s=t;t=function(){s(),y.add(e,t,r)}}this.trunk[e]=n.setTimeout(t,r)},clear:function(e){var t=function(e){n.clearTimeout(this.trunk[e]),delete this.trunk[e]},r;if(!!e&&e in this.trunk)t.call(y,e);else if(typeof e=="undefined")for(r in this.trunk)this.trunk.hasOwnProperty(r)&&t.call(y,r)}},b=[],w=[],E=!1,S=!1,x=[],T=function(t){Galleria.theme=t,e.each(x,function(e,t){t._initialized||t._init.call(t)})},N=function(){return{array:function(e){return Array.prototype.slice.call(e,0)},create:function(e,t){t=t||"div";var n=r.createElement(t);return n.className=e,n},getScriptPath:function(t){t=t||e("script:last").attr("src");var n=t.split("/");return n.length==1?"":(n.pop(),n.join("/")+"/")},animate:function(){var t=function(e){var t="transition WebkitTransition MozTransition OTransition".split(" "),r;if(n.opera)return!1;for(r=0;t[r];r++)if(typeof e[t[r]]!="undefined")return t[r];return!1}((r.body||r.documentElement).style),i={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[t],s={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},o=function(t,n,r){var i={};r=r||"transition",e.each("webkit moz ms o".split(" "),function(){i["-"+this+"-"+r]=n}),t.css(i)},u=function(e){o(e,"none","transition"),Galleria.WEBKIT&&Galleria.TOUCH&&(o(e,"translate3d(0,0,0)","transform"),e.data("revert")&&(e.css(e.data("revert")),e.data("revert",null)))},a,f,l,c,h,p,d;return function(r,v,m){m=e.extend({duration:400,complete:function(){},stop:!1},m),r=e(r);if(!m.duration){r.css(v),m.complete.call(r[0]);return}if(!t){r.animate(v,m);return}m.stop&&(r.unbind(i),u(r)),a=!1,e.each(v,function(e,t){d=r.css(e),N.parseValue(d)!=N.parseValue(t)&&(a=!0),r.css(e,d)});if(!a){n.setTimeout(function(){m.complete.call(r[0])},m.duration);return}f=[],l=m.easing in s?s[m.easing]:s._default,c=" "+m.duration+"ms"+" cubic-bezier("+l.join(",")+")",n.setTimeout(function(){r.one(i,function(e){return function(){u(e),m.complete.call(e[0])}}(r));if(Galleria.WEBKIT&&Galleria.TOUCH){h={},p=[0,0,0],e.each(["left","top"],function(e,t){t in v&&(p[e]=N.parseValue(v[t])-N.parseValue(r.css(t))+"px",h[t]=v[t],delete v[t])});if(p[0]||p[1])r.data("revert",h),f.push("-webkit-transform"+c),o(r,"translate3d("+p.join(",")+")","transform")}e.each(v,function(e,t){f.push(e+c)}),o(r,f.join(",")),r.css(v)},1)}}(),removeAlpha:function(e){if(h<9&&e){var t=e.style,n=e.currentStyle,r=n&&n.filter||t.filter||"";/alpha/.test(r)&&(t.filter=r.replace(/alpha\([^)]*\)/i,""))}},forceStyles:function(t,n){t=e(t),t.attr("style")&&t.data("styles",t.attr("style")).removeAttr("style"),t.css(n)},revertStyles:function(){e.each(N.array(arguments),function(t,n){n=e(n),n.removeAttr("style"),n.attr("style",""),n.data("styles")&&n.attr("style",n.data("styles")).data("styles",null)})},moveOut:function(e){N.forceStyles(e,{position:"absolute",left:-1e4})},moveIn:function(){N.revertStyles.apply(N,N.array(arguments))},elem:function(t){return t instanceof e?{$:t,dom:t[0]}:{$:e(t),dom:t}},hide:function(e,t,n){n=n||function(){};var r=N.elem(e),i=r.$;e=r.dom,i.data("opacity")||i.data("opacity",i.css("opacity"));var s={opacity:0};if(t){var o=h<9&&e?function(){N.removeAlpha(e),e.style.visibility="hidden",n.call(e)}:n;N.animate(e,s,{duration:t,complete:o,stop:!0})}else h<9&&e?(N.removeAlpha(e),e.style.visibility="hidden"):i.css(s)},show:function(e,t,n){n=n||function(){};var r=N.elem(e),i=r.$;e=r.dom;var s=parseFloat(i.data("opacity"))||1,o={opacity:s};if(t){h<9&&(i.css("opacity",0),e.style.visibility="visible");var u=h<9&&e?function(){o.opacity==1&&N.removeAlpha(e),n.call(e)}:n;N.animate(e,o,{duration:t,complete:u,stop:!0})}else h<9&&o.opacity==1&&e?(N.removeAlpha(e),e.style.visibility="visible"):i.css(o)},optimizeTouch:function(){var t,n,r,i,s={},o=function(t){t.preventDefault(),s=e.extend({},t,!0)},u=function(){this.evt=s},a=function(){this.handler.call(t,this.evt)};return function(s){e(s).bind("touchend",function(s){t=s.target,i=!0;while(t.parentNode&&t!=s.currentTarget&&i)n=e(t).data("events"),r=e(t).data("fakes"),n&&"click"in n?(i=!1,s.preventDefault(),e(t).click(o).click(),n.click.pop(),e.each(n.click,u),e(t).data("fakes",n.click),delete n.click):r&&(i=!1,s.preventDefault(),e.each(r,a)),t=t.parentNode})}}(),addTimer:function(){return y.add.apply(y,N.array(arguments)),this},clearTimer:function(){return y.clear.apply(y,N.array(arguments)),this},wait:function(t){t=e.extend({until:function(){return!1},success:function(){},error:function(){Galleria.raise("Could not complete wait function.")},timeout:3e3},t);var r=N.timestamp(),i,s,o=function(){s=N.timestamp(),i=s-r;if(t.until(i))return t.success(),!1;if(s>=r+t.timeout)return t.error(),!1;n.setTimeout(o,10)};n.setTimeout(o,10)},toggleQuality:function(e,t){if(h!==7&&h!==8||!e)return;typeof t=="undefined"&&(t=e.style.msInterpolationMode==="nearest-neighbor"),e.style.msInterpolationMode=t?"bicubic":"nearest-neighbor"},insertStyleTag:function(e){var t=r.createElement("style");p().head.appendChild(t);if(t.styleSheet)t.styleSheet.cssText=e;else{var n=r.createTextNode(e);t.appendChild(n)}},loadScript:function(t,n){var r=!1,i=e("<script>").attr({src:t,async:!0}).get(0);i.onload=i.onreadystatechange=function(){!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(r=!0,i.onload=i.onreadystatechange=null,typeof n=="function"&&n.call(this,this))},p().head.appendChild(i)},parseValue:function(e){if(typeof e=="number")return e;if(typeof e=="string"){var t=e.match(/\-?\d|\./g);return t&&t.constructor===Array?t.join("")*1:0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(i,s,o){var u,a=!1,f;return e("link[rel=stylesheet]").each(function(){if((new RegExp(i)).test(this.href))return u=this,!1}),typeof s=="function"&&(o=s,s=t),o=o||function(){},u?(o.call(u,u),u):(f=r.styleSheets.length,e("#"+s).length?(e("#"+s).attr("href",i),f--,a=!0):(u=e("<link>").attr({rel:"stylesheet",href:i,id:s}).get(0),n.setTimeout(function(){var t=e('link[rel="stylesheet"], style');t.length?t.get(0).parentNode.insertBefore(u,t[0]):p().head.appendChild(u);if(h){if(f>=31){Galleria.raise("You have reached the browser stylesheet limit (31)",!0);return}u.onreadystatechange=function(e){!a&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(a=!0)}}else(new RegExp("file://","i")).test(i)?a=!0:e.ajax({url:i,success:function(){a=!0},error:function(e){e.isRejected()&&Galleria.WEBKIT&&(a=!0)}})},10)),typeof o=="function"&&N.wait({until:function(){return a&&r.styleSheets.length>f},success:function(){n.setTimeout(function(){o.call(u,u)},100)},error:function(){Galleria.raise("Theme CSS could not load",!0)},timeout:1e4}),u)}}}(),C=function(){var t=function(t,n,r,i){var s=this.getOptions("easing"),o=this.getStageWidth(),u={left:o*(t.rewind?-1:1)},a={left:0};r?(u.opacity=0,a.opacity=1):u.opacity=1,e(t.next).css(u),N.animate(t.next,a,{duration:t.speed,complete:function(e){return function(){n(),e.css({left:0})}}(e(t.next).add(t.prev)),queue:!1,easing:s}),i&&(t.rewind=!t.rewind),t.prev&&(u={left:0},a={left:o*(t.rewind?1:-1)},r&&(u.opacity=1,a.opacity=0),e(t.prev).css(u),N.animate(t.prev,a,{duration:t.speed,queue:!1,easing:s,complete:function(){e(this).css("opacity",0)}}))};return{fade:function(t,n){e(t.next).css({opacity:0,left:0}).show(),N.animate(t.next,{opacity:1},{duration:t.speed,complete:n}),t.prev&&(e(t.prev).css("opacity",1).show(),N.animate(t.prev,{opacity:0},{duration:t.speed}))},flash:function(t,n){e(t.next).css({opacity:0,left:0}),t.prev?N.animate(t.prev,{opacity:0},{duration:t.speed/2,complete:function(){N.animate(t.next,{opacity:1},{duration:t.speed,complete:n})}}):N.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},pulse:function(t,n){t.prev&&e(t.prev).hide(),e(t.next).css({opacity:0,left:0}).show(),N.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},slide:function(e,n){t.apply(this,N.array(arguments))},fadeslide:function(e,n){t.apply(this,N.array(arguments).concat([!0]))},doorslide:function(e,n){t.apply(this,N.array(arguments).concat([!1,!0]))}}}();Galleria=function(){var r=this;this._theme=t,this._options={},this._playing=!1,this._playtime=5e3,this._active=null,this._queue={length:0},this._data=[],this._dom={},this._thumbnails=[],this._layers=[],this._initialized=!1,this._firstrun=!1,this._stageWidth=0,this._stageHeight=0,this._target=t,this._id=Math.random();var o="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",u="current total";e.each(o.split(" "),function(e,t){r._dom[t]=N.create("galleria-"+t)}),e.each(u.split(" "),function(e,t){r._dom[t]=N.create("galleria-"+t,"span")});var a=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(e){var t=e.keyCode||e.which;t in a.map&&typeof a.map[t]=="function"&&a.map[t].call(r,e)},attach:function(e){var t,n;for(t in e)e.hasOwnProperty(t)&&(n=t.toUpperCase(),n in a.keys?a.map[a.keys[n]]=e[t]:a.map[n]=e[t]);a.bound||(a.bound=!0,i.bind("keydown",a.press))},detach:function(){a.bound=!1,a.map={},i.unbind("keydown",a.press)}},f=this._controls={0:t,1:t,active:0,swap:function(){f.active=f.active?0:1},getActive:function(){return f[f.active]},getNext:function(){return f[1-f.active]}},l=this._carousel={next:r.$("thumb-nav-right"),prev:r.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var t=0,n=0,i=[0];e.each(r._thumbnails,function(r,s){s.ready&&(t+=s.outerWidth||e(s.container).outerWidth(!0),i[r+1]=t,n=Math.max(n,s.outerHeight||e(s.container).outerHeight(!0)))}),r.$("thumbnails").css({width:t,height:n}),l.max=t,l.hooks=i,l.width=r.$("thumbnails-list").width(),l.setClasses(),r.$("thumbnails-container").toggleClass("galleria-carousel",t>l.width),l.width=r.$("thumbnails-list").width()},bindControls:function(){var e;l.next.bind("click",function(t){t.preventDefault();if(r._options.carouselSteps==="auto"){for(e=l.current;e<l.hooks.length;e++)if(l.hooks[e]-l.hooks[l.current]>l.width){l.set(e-2);break}}else l.set(l.current+r._options.carouselSteps)}),l.prev.bind("click",function(t){t.preventDefault();if(r._options.carouselSteps==="auto")for(e=l.current;e>=0;e--){if(l.hooks[l.current]-l.hooks[e]>l.width){l.set(e+2);break}if(e===0){l.set(0);break}}else l.set(l.current-r._options.carouselSteps)})},set:function(e){e=Math.max(e,0);while(l.hooks[e-1]+l.width>=l.max&&e>=0)e--;l.current=e,l.animate()},getLast:function(e){return(e||l.current)-1},follow:function(e){if(e===0||e===l.hooks.length-2){l.set(e);return}var t=l.current;while(l.hooks[t]-l.hooks[l.current]<l.width&&t<=l.hooks.length)t++;e-1<l.current?l.set(e-1):e+2>t&&l.set(e-t+l.current+2)},setClasses:function(){l.prev.toggleClass("disabled",!l.current),l.next.toggleClass("disabled",l.hooks[l.current]+l.width>=l.max)},animate:function(e){l.setClasses();var t=l.hooks[l.current]*-1;if(isNaN(t))return;N.animate(r.get("thumbnails"),{left:t},{duration:r._options.carouselSpeed,easing:r._options.easing,queue:!1})}},c=this._tooltip={initialized:!1,open:!1,init:function(){c.initialized=!0;var e=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";N.insertStyleTag(e),r.$("tooltip").css("opacity",.8),N.hide(r.get("tooltip"))},move:function(e){var t=r.getMousePosition(e).x,n=r.getMousePosition(e).y,i=r.$("tooltip"),s=t,o=n,u=i.outerHeight(!0)+1,a=i.outerWidth(!0),f=u+15,l=r.$("container").width()-a-2,c=r.$("container").height()-u-2;!isNaN(s)&&!isNaN(o)&&(s+=10,o-=30,s=Math.max(0,Math.min(l,s)),o=Math.max(0,Math.min(c,o)),n<f&&(o=f),i.css({left:s,top:o}))},bind:function(t,n){if(Galleria.TOUCH)return;c.initialized||c.init();var i=function(t,n){c.define(t,n),e(t).hover(function(){N.clearTimer("switch_tooltip"),r.$("container").unbind("mousemove",c.move).bind("mousemove",c.move).trigger("mousemove"),c.show(t),Galleria.utils.addTimer("tooltip",function(){r.$("tooltip").stop().show().animate({opacity:1}),c.open=!0},c.open?0:500)},function(){r.$("container").unbind("mousemove",c.move),N.clearTimer("tooltip"),r.$("tooltip").stop().animate({opacity:0},200,function(){r.$("tooltip").hide(),N.addTimer("switch_tooltip",function(){c.open=!1},1e3)})})};typeof n=="string"?i(t in r._dom?r.get(t):t,n):e.each(t,function(e,t){i(r.get(e),t)})},show:function(t){t=e(t in r._dom?r.get(t):t);var i=t.data("tt"),s=function(e){n.setTimeout(function(e){return function(){c.move(e)}}(e),10),t.unbind("mouseup",s)};i=typeof i=="function"?i():i;if(!i)return;r.$("tooltip").html(i.replace(/\s/,"&nbsp;")),t.bind("mouseup",s)},define:function(t,n){if(typeof n!="function"){var i=n;n=function(){return i}}t=e(t in r._dom?r.get(t):t).data("tt",n),c.show(t)}},d=this._fullscreen={scrolled:0,crop:t,transition:t,active:!1,keymap:r._keyboard.map,enter:function(n){d.active=!0,N.hide(r.getActiveImage()),r.$("container").addClass("fullscreen"),d.scrolled=s.scrollTop(),N.forceStyles(r.get("container"),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4});var i={height:"100%",overflow:"hidden",margin:0,padding:0},o=r.getData(),u=r._options;N.forceStyles(p().html,i),N.forceStyles(p().body,i),d.keymap=e.extend({},r._keyboard.map),r.attachKeyboard({escape:r.exitFullscreen,right:r.next,left:r.prev}),d.crop=u.imageCrop,u.fullscreenCrop!=t&&(u.imageCrop=u.fullscreenCrop);if(o&&o.big&&o.image!==o.big){var a=new Galleria.Picture,f=a.isCached(o.big),l=r.getIndex(),c=r._thumbnails[l];r.trigger({type:Galleria.LOADSTART,cached:f,rewind:!1,index:l,imageTarget:r.getActiveImage(),thumbTarget:c}),a.load(o.big,function(t){r._scaleImage(t,{complete:function(t){r.trigger({type:Galleria.LOADFINISH,cached:f,index:l,rewind:!1,imageTarget:t.image,thumbTarget:c});var n=r._controls.getActive().image;n&&e(n).width(t.image.width).height(t.image.height).attr("style",e(t.image).attr("style")).attr("src",t.image.src)}})})}r.rescale(function(){N.addTimer("fullscreen_enter",function(){N.show(r.getActiveImage()),typeof n=="function"&&n.call(r)},100),r.trigger(Galleria.FULLSCREEN_ENTER)}),s.resize(function(){d.scale()})},scale:function(){r.rescale()},exit:function(e){d.active=!1,N.hide(r.getActiveImage()),r.$("container").removeClass("fullscreen"),N.revertStyles(r.get("container"),p().html,p().body),n.scrollTo(0,d.scrolled),r.detachKeyboard(),r.attachKeyboard(d.keymap),r._options.imageCrop=d.crop;var t=r.getData().big,i=r._controls.getActive().image;t&&t==i.src&&n.setTimeout(function(e){return function(){i.src=e}}(r.getData().image),1),r.rescale(function(){N.addTimer("fullscreen_exit",function(){N.show(r.getActiveImage()),typeof e=="function"&&e.call(r)},50),r.trigger(Galleria.FULLSCREEN_EXIT)}),s.unbind("resize",d.scale)}},v=this._idle={trunk:[],bound:!1,add:function(t,n){if(!t)return;v.bound||v.addEvent(),t=e(t);var r={},i;for(i in n)n.hasOwnProperty(i)&&(r[i]=t.css(i));t.data("idle",{from:r,to:n,complete:!0,busy:!1}),v.addTimer(),v.trunk.push(t)},remove:function(t){t=jQuery(t),e.each(v.trunk,function(e,n){n.length&&!n.not(t).length&&(r._idle.show(t),r._idle.trunk.splice(e,1))}),v.trunk.length||(v.removeEvent(),N.clearTimer("idle"))},addEvent:function(){v.bound=!0,r.$("container").bind("mousemove click",v.showAll)},removeEvent:function(){v.bound=!1,r.$("container").unbind("mousemove click",v.showAll)},addTimer:function(){N.addTimer("idle",function(){r._idle.hide()},r._options.idleTime)},hide:function(){if(!r._options.idleMode)return;r.trigger(Galleria.IDLE_ENTER),e.each(v.trunk,function(e,t){var n=t.data("idle");if(!n)return;t.data("idle").complete=!1,N.animate(t,n.to,{duration:r._options.idleSpeed})})},showAll:function(){N.clearTimer("idle"),e.each(r._idle.trunk,function(e,t){r._idle.show(t)})},show:function(t){var n=t.data("idle");!n.busy&&!n.complete&&(n.busy=!0,r.trigger(Galleria.IDLE_EXIT),N.clearTimer("idle"),N.animate(t,n.from,{duration:r._options.idleSpeed/2,complete:function(){e(this).data("idle").busy=!1,e(this).data("idle").complete=!0}})),v.addTimer()}},m=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){r.trigger(Galleria.LIGHTBOX_OPEN);if(m.initialized)return;m.initialized=!0;var t="overlay box content shadow title info close prevholder prev nextholder next counter image",n={},i=r._options,s="",o="position:absolute;",u="lightbox-",a={overlay:"position:fixed;display:none;opacity:"+i.overlayOpacity+";filter:alpha(opacity="+i.overlayOpacity*100+");top:0;left:0;width:100%;height:100%;background:"+i.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:o+"background:#000;width:100%;height:100%;",content:o+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:o+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:o+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:o+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:o+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:o+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},f=function(t){return t.hover(function(){e(this).css("color","#bbb")},function(){e(this).css("color","#444")})},l={};h===8&&(a.nextholder+="background:#000;filter:alpha(opacity=0);",a.prevholder+="background:#000;filter:alpha(opacity=0);"),e.each(a,function(e,t){s+=".galleria-"+u+e+"{"+t+"}"}),N.insertStyleTag(s),e.each(t.split(" "),function(e,t){r.addElement("lightbox-"+t),n[t]=m.elems[t]=r.get("lightbox-"+t)}),m.image=new Galleria.Picture,e.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(t,n){var r=[];e.each(n.split(" "),function(e,t){r.push(u+t)}),l[u+t]=r}),r.append(l),e(n.image).append(m.image.container),e(p().body).append(n.overlay,n.box),N.optimizeTouch(n.box),f(e(n.close).bind("click",m.hide).html("&#215;")),e.each(["Prev","Next"],function(t,r){var i=e(n[r.toLowerCase()]).html(/v/.test(r)?"&#8249;&nbsp;":"&nbsp;&#8250;"),s=e(n[r.toLowerCase()+"holder"]);s.bind("click",function(){m["show"+r]()});if(h<8||Galleria.TOUCH){i.show();return}s.hover(function(){i.show()},function(e){i.stop().fadeOut(200)})}),e(n.overlay).bind("click",m.hide),Galleria.IPAD&&(r._options.lightboxTransitionSpeed=0)},rescale:function(t){var n=Math.min(s.width()-40,m.width),i=Math.min(s.height()-60,m.height),o=Math.min(n/m.width,i/m.height),u=Math.round(m.width*o)+40,a=Math.round(m.height*o)+60,f={width:u,height:a,"margin-top":Math.ceil(a/2)*-1,"margin-left":Math.ceil(u/2)*-1};t?e(m.elems.box).css(f):e(m.elems.box).animate(f,{duration:r._options.lightboxTransitionSpeed,easing:r._options.easing,complete:function(){var t=m.image,n=r._options.lightboxFadeSpeed;r.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:t.image}),e(t.container).show(),N.show(t.image,n),N.show(m.elems.info,n)}})},hide:function(){m.image.image=null,s.unbind("resize",m.rescale),e(m.elems.box).hide(),N.hide(m.elems.info),r.detachKeyboard(),r.attachKeyboard(m.keymap),m.keymap=!1,N.hide(m.elems.overlay,200,function(){e(this).hide().css("opacity",r._options.overlayOpacity),r.trigger(Galleria.LIGHTBOX_CLOSE)})},showNext:function(){m.show(r.getNext(m.active))},showPrev:function(){m.show(r.getPrev(m.active))},show:function(t){m.active=t=typeof t=="number"?t:r.getIndex(),m.initialized||m.init(),m.keymap||(m.keymap=e.extend({},r._keyboard.map),r.attachKeyboard({escape:m.hide,right:m.showNext,left:m.showPrev})),s.unbind("resize",m.rescale);var n=r.getData(t),i=r.getDataLength(),o=r.getNext(t),u,a,f;N.hide(m.elems.info);try{for(f=r._options.preload;f>0;f--)a=new Galleria.Picture,u=r.getData(o),a.preload("big"in u?u.big:u.image),o=r.getNext(o)}catch(l){}m.image.load(n.big||n.image,function(r){m.width=r.original.width,m.height=r.original.height,e(r.image).css({width:"100.5%",height:"100.5%",top:0,zIndex:99998}),N.hide(r.image),m.elems.title.innerHTML=n.title||"",m.elems.counter.innerHTML=t+1+" / "+i,s.resize(m.rescale),m.rescale()}),e(m.elems.overlay).show(),e(m.elems.box).show()}};return this},Galleria.prototype={constructor:Galleria,init:function(n,r){var i=this;r=m(r),this._original={target:n,options:r,data:null},this._target=this._dom.target=n.nodeName?n:e(n).get(0),w.push(this);if(!this._target){Galleria.raise("Target not found.",!0);return}return this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dataConfig:function(e){return{}},dataSelector:"img",dataSource:this._target,debug:t,dummy:t,easing:"galleria",extend:function(e){},fullscreenCrop:t,fullscreenDoubleTap:!0,fullscreenTransition:t,height:"auto",idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:t,initialTransition:t,keepSource:!1,layerFollow:!0,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:!0,maxScaleRatio:t,minScaleRatio:t,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,queue:!0,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:!0,thumbCrop:!0,thumbEventType:"click",thumbFit:!0,thumbMargin:0,thumbQuality:"auto",thumbnails:!0,touchTransition:t,transition:"fade",transitionInitial:t,transitionSpeed:400,useCanvas:!1,width:"auto"},this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial,r&&r.debug===!1&&(u=!1),r&&typeof r.imageTimeout=="number"&&(a=r.imageTimeout),r&&typeof r.dummy=="string"&&(f=r.dummy),e(this._target).children().hide(),typeof Galleria.theme=="object"?this._init():x.push(this),this},_init:function(){var t=this,i=this._options;if(this._initialized)return Galleria.raise("Init failed: Gallery instance already initialized."),this;this._initialized=!0;if(!Galleria.theme)return Galleria.raise("Init failed: No theme found."),this;e.extend(!0,i,Galleria.theme.defaults,this._original.options),function(e){if(!("getContext"in e)){e=null;return}S=S||{elem:e,context:e.getContext("2d"),cache:{},length:0}}(r.createElement("canvas")),this.bind(Galleria.DATA,function(){Galleria.QUIRK&&Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML."),this._original.data=this._data,this.get("total").innerHTML=this.getDataLength();var r=this.$("container"),s={width:0,height:0},o=function(){return t.$("stage").height()};N.wait({until:function(){return e.each(["width","height"],function(e,n){i[n]&&typeof i[n]=="number"?s[n]=i[n]:s[n]=Math.max(N.parseValue(r.css(n)),N.parseValue(t.$("target").css(n)),r[n](),t.$("target")[n]()),r[n](s[n])}),o()&&s.width&&s.height>10},success:function(){Galleria.WEBKIT?n.setTimeout(function(){t._run()},1):t._run()},error:function(){o()?Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+s.width+"px, height: "+s.height+"px.",!0):Galleria.raise("Could not extract a stage height from the CSS. Traced height: "+o()+"px.",!0)},timeout:1e4})}),this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]}),N.hide(this.$("counter").append(this.get("current"),r.createTextNode(" / "),this.get("total"))),this.setCounter("&#8211;"),N.hide(t.get("tooltip")),this.$("container").addClass(Galleria.TOUCH?"touch":"notouch"),e.each(new Array(2),function(n){var r=new Galleria.Picture;e(r.container).css({position:"absolute",top:0,left:0}).prepend(t._layers[n]=e(N.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]),t.$("images").append(r.container),t._controls[n]=r}),this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"}),this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"}),this.$("image-nav-right, image-nav-left").bind("click",function(e){i.clicknext&&e.stopPropagation(),i.pauseOnInteraction&&t.pause();var n=/right/.test(this.className)?"next":"prev";t[n]()}),e.each(["info","counter","image-nav"],function(e,n){i["show"+n.substr(0,1).toUpperCase()+n.substr(1).replace(/-/,"")]===!1&&N.moveOut(t.get(n.toLowerCase()))}),this.load(),!i.keepSource&&!h&&(this._target.innerHTML=""),this.get("errors")&&this.appendChild("target","errors"),this.appendChild("target","container");if(i.carousel){var s=0,o=i.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel(),++s==this.getDataLength()&&typeof o=="number"&&o>0&&this._carousel.follow(o)})}return i.swipe&&(function(e){var n=[0,0],r=[0,0],i=30,s=100,o=!1,u=0,a,f={start:"touchstart",move:"touchmove",stop:"touchend"},l=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e},c=function(e){if(e.originalEvent.touches&&e.originalEvent.touches.length>1)return;a=l(e),r=[a.pageX,a.pageY],n[0]||(n=r),Math.abs(n[0]-r[0])>10&&e.preventDefault()},h=function(a){e.unbind(f.move,c);if(a.originalEvent.touches&&a.originalEvent.touches.length||o){o=!o;return}N.timestamp()-u<1e3&&Math.abs(n[0]-r[0])>i&&Math.abs(n[1]-r[1])<s&&(a.preventDefault(),t[n[0]>r[0]?"next":"prev"]()),n=r=[0,0]};e.bind(f.start,function(t){if(t.originalEvent.touches&&t.originalEvent.touches.length>1)return;a=l(t),u=N.timestamp(),n=r=[a.pageX,a.pageY],e.bind(f.move,c).one(f.stop,h)})}(t.$("images")),i.fullscreenDoubleTap&&this.$("stage").bind("touchstart",function(){var e,n,r,i,s,o,u=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e};return function(a){o=Galleria.utils.timestamp(),n=u(a).pageX,r=u(a).pageY;if(o-e<500&&n-i<20&&r-s<20){t.toggleFullscreen(),a.preventDefault(),t.$("stage").unbind("touchend",arguments.callee);return}e=o,i=n,s=r}}())),N.optimizeTouch(this.get("container")),this},_createThumbnails:function(){this.get("total").innerHTML=this.getDataLength();var t,i,s,o,u,a=this,f=this._options,l=function(){var e=a.$("thumbnails").find(".active");return e.length?e.find("img").attr("src"):!1}(),c=typeof f.thumbnails=="string"?f.thumbnails.toLowerCase():null,h=function(e){return r.defaultView&&r.defaultView.getComputedStyle?r.defaultView.getComputedStyle(s.container,null)[e]:u.css(e)},p=function(t,n,r){return function(){e(r).append(t),a.trigger({type:Galleria.THUMBNAIL,thumbTarget:t,index:n})}},d=function(t){f.pauseOnInteraction&&a.pause();var n=e(t.currentTarget).data("index");a.getIndex()!==n&&a.show(n),t.preventDefault()},v=function(t){t.scale({width:t.data.width,height:t.data.height,crop:f.thumbCrop,margin:f.thumbMargin,canvas:f.useCanvas,complete:function(t){var n=["left","top"],r=["Width","Height"],i,s;e.each(r,function(r,o){i=o.toLowerCase(),(f.thumbCrop!==!0||f.thumbCrop===i)&&f.thumbFit&&(s={},s[i]=t[i],e(t.container).css(s),s={},s[n[r]]=0,e(t.image).css(s)),t["outer"+o]=e(t.container)["outer"+o](!0)}),N.toggleQuality(t.image,f.thumbQuality===!0||f.thumbQuality==="auto"&&t.original.width<t.width*3),a.trigger({type:Galleria.THUMBNAIL,thumbTarget:t.image,index:t.data.order})}})};this._thumbnails=[],this.$("thumbnails").empty();for(t=0;this._data[t];t++)o=this._data[t],f.thumbnails===!0?(s=new Galleria.Picture(t),i=o.thumb||o.image,this.$("thumbnails").append(s.container),u=e(s.container),s.data={width:N.parseValue(h("width")),height:N.parseValue(h("height")),order:t},f.thumbFit&&f.thumbCrop!==!0?u.css({width:0,height:0}):u.css({width:s.data.width,height:s.data.height}),s.load(i,v),f.preload==="all"&&s.preload(o.image)):c==="empty"||c==="numbers"?(s={container:N.create("galleria-image"),image:N.create("img","span"),ready:!0},c==="numbers"&&e(s.image).text(t+1),this.$("thumbnails").append(s.container),n.setTimeout(p(s.image,t,s.container),50+t*20)):s={container:null,image:null},e(s.container).add(f.keepSource&&f.linkSourceImages?o.original:null).data("index",t).bind(f.thumbEventType,d),l===i&&e(s.container).addClass("active"),this._thumbnails.push(s)},_run:function(){var r=this;r._createThumbnails(),N.wait({until:function(){return Galleria.OPERA&&r.$("stage").css("display","inline-block"),r._stageWidth=r.$("stage").width(),r._stageHeight=r.$("stage").height(),r._stageWidth&&r._stageHeight>50},success:function(){b.push(r),N.show(r.get("counter")),r._options.carousel&&r._carousel.bindControls(),r._options.autoplay&&(r.pause(),typeof r._options.autoplay=="number"&&(r._playtime=r._options.autoplay),r.trigger(Galleria.PLAY),r._playing=!0);if(r._firstrun){typeof r._options.show=="number"&&r.show(r._options.show);return}r._firstrun=!0,r._options.clicknext&&!Galleria.TOUCH&&(e.each(r._data,function(e,t){delete t.link}),r.$("stage").css({cursor:"pointer"}).bind("click",function(e){r._options.pauseOnInteraction&&r.pause(),r.next()})),Galleria.History&&Galleria.History.change(function(e){isNaN(e)?n.history.go(-1):r.show(e,t,!0)}),e.each(Galleria.ready.callbacks,function(){this.call(r,r._options)}),r.trigger(Galleria.READY),Galleria.theme.init.call(r,r._options),r._options.extend.call(r,r._options),/^[0-9]{1,4}$/.test(c)&&Galleria.History?r.show(c,t,!0):r._data[r._options.show]&&r.show(r._options.show)},error:function(){Galleria.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+r._stageWidth+"px, height: "+r._stageHeight+"px.",!0)}})},load:function(t,n,r){var i=this;return this._data=[],this._thumbnails=[],this.$("thumbnails").empty(),typeof n=="function"&&(r=n,n=null),t=t||this._options.dataSource,n=n||this._options.dataSelector,r=r||this._options.dataConfig,/^function Object/.test(t.constructor)&&(t=[t]),t.constructor===Array?(this.validate(t)?(this._data=t,this._parseData().trigger(Galleria.DATA)):Galleria.raise("Load failed: JSON Array not valid."),this):(e(t).find(n).each(function(t,n){n=e(n);var s={},o=n.parent(),u=o.attr("href"),a=o.attr("rel");u&&(s.image=s.big=u),a&&(s.big=a),i._data.push(e.extend({title:n.attr("title")||"",thumb:n.attr("src"),image:n.attr("src"),big:n.attr("src"),description:n.attr("alt")||"",link:n.attr("longdesc"),original:n.get(0)},s,r(n)))}),this.getDataLength()?this.trigger(Galleria.DATA):Galleria.raise("Load failed: no data found."),this)},_parseData:function(){var t=this;return e.each(this._data,function(e,n){"thumb"in n==0&&(t._data[e].thumb=n.image),!1 in n&&(t._data[e].big=n.image)}),this},splice:function(){return Array.prototype.splice.apply(this._data,N.array(arguments)),this._parseData()._createThumbnails()},push:function(){return Array.prototype.push.apply(this._data,N.array(arguments
)),this._parseData()._createThumbnails()},_getActive:function(){return this._controls.getActive()},validate:function(e){return!0},bind:function(e,t){return e=g(e),this.$("container").bind(e,this.proxy(t)),this},unbind:function(e){return e=g(e),this.$("container").unbind(e),this},trigger:function(t){return t=typeof t=="object"?e.extend(t,{scope:this}):{type:g(t),scope:this},this.$("container").trigger(t),this},addIdleState:function(e,t){return this._idle.add.apply(this._idle,N.array(arguments)),this},removeIdleState:function(e){return this._idle.remove.apply(this._idle,N.array(arguments)),this},enterIdleMode:function(){return this._idle.hide(),this},exitIdleMode:function(){return this._idle.showAll(),this},enterFullscreen:function(e){return this._fullscreen.enter.apply(this,N.array(arguments)),this},exitFullscreen:function(e){return this._fullscreen.exit.apply(this,N.array(arguments)),this},toggleFullscreen:function(e){return this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,N.array(arguments)),this},bindTooltip:function(e,t){return this._tooltip.bind.apply(this._tooltip,N.array(arguments)),this},defineTooltip:function(e,t){return this._tooltip.define.apply(this._tooltip,N.array(arguments)),this},refreshTooltip:function(e){return this._tooltip.show.apply(this._tooltip,N.array(arguments)),this},openLightbox:function(){return this._lightbox.show.apply(this._lightbox,N.array(arguments)),this},closeLightbox:function(){return this._lightbox.hide.apply(this._lightbox,N.array(arguments)),this},getActiveImage:function(){return this._getActive().image||t},getActiveThumb:function(){return this._thumbnails[this._active].image||t},getMousePosition:function(e){return{x:e.pageX-this.$("container").offset().left,y:e.pageY-this.$("container").offset().top}},addPan:function(t){if(this._options.imageCrop===!1)return;t=e(t||this.getActiveImage());var n=this,r=t.width()/2,i=t.height()/2,s=parseInt(t.css("left"),10),o=parseInt(t.css("top"),10),u=s||0,a=o||0,f=0,l=0,c=!1,p=N.timestamp(),d=0,v=0,m=function(e,n,r){if(e>0){v=Math.round(Math.max(e*-1,Math.min(0,n)));if(d!==v){d=v;if(h===8)t.parent()["scroll"+r](v*-1);else{var i={};i[r.toLowerCase()]=v,t.css(i)}}}},g=function(e){if(N.timestamp()-p<50)return;c=!0,r=n.getMousePosition(e).x,i=n.getMousePosition(e).y},y=function(e){if(!c)return;f=t.width()-n._stageWidth,l=t.height()-n._stageHeight,s=r/n._stageWidth*f*-1,o=i/n._stageHeight*l*-1,u+=(s-u)/n._options.imagePanSmoothness,a+=(o-a)/n._options.imagePanSmoothness,m(l,a,"Top"),m(f,u,"Left")};return h===8&&(t.parent().scrollTop(a*-1).scrollLeft(u*-1),t.css({top:0,left:0})),this.$("stage").unbind("mousemove",g).bind("mousemove",g),N.addTimer("pan",y,50,!0),this},proxy:function(e,t){return typeof e!="function"?function(){}:(t=t||this,function(){return e.apply(t,N.array(arguments))})},removePan:function(){return this.$("stage").unbind("mousemove"),N.clearTimer("pan"),this},addElement:function(t){var n=this._dom;return e.each(N.array(arguments),function(e,t){n[t]=N.create("galleria-"+t)}),this},attachKeyboard:function(e){return this._keyboard.attach.apply(this._keyboard,N.array(arguments)),this},detachKeyboard:function(){return this._keyboard.detach.apply(this._keyboard,N.array(arguments)),this},appendChild:function(e,t){return this.$(e).append(this.get(t)||t),this},prependChild:function(e,t){return this.$(e).prepend(this.get(t)||t),this},remove:function(e){return this.$(N.array(arguments).join(",")).remove(),this},append:function(e){var t,n;for(t in e)if(e.hasOwnProperty(t))if(e[t].constructor===Array)for(n=0;e[t][n];n++)this.appendChild(t,e[t][n]);else this.appendChild(t,e[t]);return this},_scaleImage:function(t,n){t=t||this._controls.getActive();if(!t)return;var r=this,i,s=function(t){e(t.container).children(":first").css({top:Math.max(0,N.parseValue(t.image.style.top)),left:Math.max(0,N.parseValue(t.image.style.left)),width:N.parseValue(t.image.width),height:N.parseValue(t.image.height)})};return n=e.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},n),this._options.layerFollow&&this._options.imageCrop!==!0?typeof n.complete=="function"?(i=n.complete,n.complete=function(){i.call(t,t),s(t)}):n.complete=s:e(t.container).children(":first").css({top:0,left:0}),t.scale(n),this},updateCarousel:function(){return this._carousel.update(),this},rescale:function(e,n,r){var i=this;typeof e=="function"&&(r=e,e=t);var s=function(){i._stageWidth=e||i.$("stage").width(),i._stageHeight=n||i.$("stage").height(),i._scaleImage(),i._options.carousel&&i.updateCarousel(),i.trigger(Galleria.RESCALE),typeof r=="function"&&r.call(i)};return Galleria.WEBKIT&&!e&&!n?N.addTimer("scale",s,10):s.call(i),this},refreshImage:function(){return this._scaleImage(),this._options.imagePan&&this.addPan(),this},show:function(e,t,n){if(e===!1||!this._options.queue&&this._queue.stalled)return;e=Math.max(0,Math.min(parseInt(e,10),this.getDataLength()-1)),t=typeof t!="undefined"?!!t:e<this.getIndex(),n=n||!1;if(!n&&Galleria.History){Galleria.History.set(e.toString());return}return this._active=e,Array.prototype.push.call(this._queue,{index:e,rewind:t}),this._queue.stalled||this._show(),this},_show:function(){var r=this,i=this._queue[0],s=this.getData(i.index);if(!s)return;var o=this.isFullscreen()&&"big"in s?s.big:s.image,u=this._controls.getActive(),a=this._controls.getNext(),f=a.isCached(o),l=this._thumbnails[i.index],c=function(t,i,s,o,u){return function(){var a;r._queue.stalled=!1,N.toggleQuality(i.image,r._options.imageQuality),r._layers[r._controls.active].innerHTML="",e(s.container).css({zIndex:0,opacity:0}).show(),e(i.container).css({zIndex:1}).show(),r._controls.swap(),r._options.imagePan&&r.addPan(i.image),(t.link||r._options.lightbox)&&e(i.image).css({cursor:"pointer"}).bind("mouseup",function(){if(t.link){r._options.popupLinks?a=n.open(t.link,"_blank"):n.location.href=t.link;return}r.openLightbox()}),Array.prototype.shift.call(r._queue),r._queue.length&&r._show(),r._playCheck(),r.trigger({type:Galleria.IMAGE,index:o.index,imageTarget:i.image,thumbTarget:u.image})}}(s,a,u,i,l);this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(i.index);if(this._options.preload){var h,p,d=this.getNext(),v;try{for(p=this._options.preload;p>0;p--)h=new Galleria.Picture,v=r.getData(d),h.preload(this.isFullscreen()&&"big"in v?v.big:v.image),d=r.getNext(d)}catch(m){}}N.show(a.container),e(r._thumbnails[i.index].container).addClass("active").siblings(".active").removeClass("active"),r.trigger({type:Galleria.LOADSTART,cached:f,index:i.index,rewind:i.rewind,imageTarget:a.image,thumbTarget:l.image}),a.load(o,function(n){var o=e(r._layers[1-r._controls.active]).html(s.layer||"").hide();r._scaleImage(n,{complete:function(n){"image"in u&&N.toggleQuality(u.image,!1),N.toggleQuality(n.image,!1),r._queue.stalled=!0,r.removePan(),r.setInfo(i.index),r.setCounter(i.index),s.layer&&(o.show(),(s.link||r._options.clicknext)&&o.css("cursor","pointer").one("click",function(){s.link?e(n.image).trigger("mouseup"):r.$("stage").trigger("click")})),r.trigger({type:Galleria.LOADFINISH,cached:f,index:i.index,rewind:i.rewind,imageTarget:n.image,thumbTarget:r._thumbnails[i.index].image});var a=r._options.transition;e.each({initial:u.image===null,touch:Galleria.TOUCH,fullscreen:r.isFullscreen()},function(e,n){if(n&&r._options[e+"Transition"]!==t)return a=r._options[e+"Transition"],!1});if(a in C==0)c();else{var l={prev:u.container,next:n.container,rewind:i.rewind,speed:r._options.transitionSpeed||400};C[a].call(r,l,c)}}})})},getNext:function(e){return e=typeof e=="number"?e:this.getIndex(),e===this.getDataLength()-1?0:e+1},getPrev:function(e){return e=typeof e=="number"?e:this.getIndex(),e===0?this.getDataLength()-1:e-1},next:function(){return this.getDataLength()>1&&this.show(this.getNext(),!1),this},prev:function(){return this.getDataLength()>1&&this.show(this.getPrev(),!0),this},get:function(e){return e in this._dom?this._dom[e]:null},getData:function(e){return e in this._data?this._data[e]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active=="number"?this._active:!1},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(e){return typeof e=="undefined"?this._options:this._options[e]},setOptions:function(t,n){return typeof t=="object"?e.extend(this._options,t):this._options[t]=n,this},play:function(e){return this._playing=!0,this._playtime=e||this._playtime,this._playCheck(),this.trigger(Galleria.PLAY),this},pause:function(){return this._playing=!1,this.trigger(Galleria.PAUSE),this},playToggle:function(e){return this._playing?this.pause():this.play(e)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var e=this,t=0,n=20,r=N.timestamp(),i="play"+this._id;if(this._playing){N.clearTimer(i);var s=function(){t=N.timestamp()-r;if(t>=e._playtime&&e._playing){N.clearTimer(i),e.next();return}e._playing&&(e.trigger({type:Galleria.PROGRESS,percent:Math.ceil(t/e._playtime*100),seconds:Math.floor(t/1e3),milliseconds:t}),N.addTimer(i,s,n))};N.addTimer(i,s,n)}},setPlaytime:function(e){return this._playtime=e,this},setIndex:function(e){return this._active=e,this},setCounter:function(e){typeof e=="number"?e++:typeof e=="undefined"&&(e=this.getIndex()+1),this.get("current").innerHTML=e;if(h){var t=this.$("counter"),n=t.css("opacity");parseInt(n,10)===1?N.removeAlpha(t[0]):this.$("counter").css("opacity",n)}return this},setInfo:function(t){var n=this,r=this.getData(t);return e.each(["title","description"],function(e,t){var i=n.$("info-"+t);r[t]?i[r[t].length?"show":"hide"]().html(r[t]):i.empty().hide()}),this},hasInfo:function(e){var t="title description".split(" "),n;for(n=0;t[n];n++)if(!!this.getData(e)[t[n]])return!0;return!1},jQuery:function(t){var n=this,r=[];e.each(t.split(","),function(t,i){i=e.trim(i),n.get(i)&&r.push(i)});var i=e(n.get(r.shift()));return e.each(r,function(e,t){i=i.add(n.get(t))}),i},$:function(e){return this.jQuery.apply(this,N.array(arguments))}},e.each(v,function(e,t){var n=/_/.test(t)?t.replace(/_/g,""):t;Galleria[t.toUpperCase()]="galleria."+n}),e.extend(Galleria,{IE9:h===9,IE8:h===8,IE7:h===7,IE6:h===6,IE:h,WEBKIT:/webkit/.test(l),SAFARI:/safari/.test(l),CHROME:/chrome/.test(l),QUIRK:h&&r.compatMode&&r.compatMode==="BackCompat",MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!n.opera,IPHONE:/iphone/.test(l),IPAD:/ipad/.test(l),ANDROID:/android/.test(l),TOUCH:"ontouchstart"in r}),Galleria.addTheme=function(t){t.name||Galleria.raise("No theme name specified"),typeof t.defaults!="object"?t.defaults={}:t.defaults=m(t.defaults);var n=!1,r;return typeof t.css=="string"?(e("link").each(function(e,i){r=new RegExp(t.css);if(r.test(i.href))return n=!0,T(t),!1}),n||e("script").each(function(e,i){r=new RegExp("galleria\\."+t.name.toLowerCase()+"\\."),r.test(i.src)&&(n=i.src.replace(/[^\/]*$/,"")+t.css,N.addTimer("css",function(){N.loadCSS(n,"galleria-theme",function(){T(t)})},1))}),n||Galleria.raise("No theme CSS loaded")):T(t),t},Galleria.loadTheme=function(r,i){var s=!1,o=b.length,u=n.setTimeout(function(){Galleria.raise("Theme at "+r+" could not load, check theme path.",!0)},5e3);Galleria.theme=t,N.loadScript(r,function(){n.clearTimeout(u);if(o){var t=[];e.each(Galleria.get(),function(n,r){var s=e.extend(r._original.options,{data_source:r._data},i);r.$("container").remove();var o=new Galleria;o._id=r._id,o.init(r._original.target,s),t.push(o)}),b=t}})},Galleria.get=function(e){if(!!w[e])return w[e];if(typeof e!="number")return w;Galleria.raise("Gallery index "+e+" not found")},Galleria.addTransition=function(e,t){C[e]=t},Galleria.utils=N,Galleria.log=function(){return"console"in n&&"log"in n.console?n.console.log:function(){n.alert(N.array(arguments).join(", "))}}(),Galleria.ready=function(t){e.each(b,function(e,n){t.call(n,n._options)}),Galleria.ready.callbacks.push(t)},Galleria.ready.callbacks=[],Galleria.raise=function(t,n){var r=n?"Fatal error":"Error",i=this,s=function(t){var i='<div style="padding:4px;margin:0 0 2px;background:#'+(n?"811":"222")+'";>'+(n?"<strong>"+r+": </strong>":"")+t+"</div>";e.each(w,function(){var e=this.$("errors"),t=this.$("target");e.length||(t.css("position","relative"),e=this.addElement("errors").appendChild("target","errors").$("errors").css({color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5})),e.append(i)})};if(u){s(t);if(n)throw new Error(r+": "+t)}else if(n){if(E)return;E=!0,n=!1,s("Image gallery could not load.")}},Galleria.version=o,Galleria.requires=function(e,t){t=t||"You need to upgrade Galleria to version "+e+" to use one or more components.",Galleria.version<e&&Galleria.raise(t,!0)},Galleria.Picture=function(t){this.id=t||null,this.image=null,this.container=N.create("galleria-image"),e(this.container).css({overflow:"hidden",position:"relative"}),this.original={width:0,height:0},this.ready=!1,this.tid=null},Galleria.Picture.prototype={cache:{},show:function(){N.show(this.image)},hide:function(){N.moveOut(this.image)},clear:function(){this.image=null},isCached:function(e){return!!this.cache[e]},preload:function(t){e(new Image).load(function(e,t){return function(){t[e]=e}}(t,this.cache)).attr("src",t)},load:function(t,r){this.tid=n.setTimeout(function(e){return function(){Galleria.raise("Image not loaded in "+Math.round(a/1e3)+" seconds: "+e)}}(t),a),this.image=new Image;var i=0,s=!1,o=e(this.container),u=e(this.image),l=function(t,r,i){return function(){var s=function(){e(this).unbind("load"),t.original={height:this.height,width:this.width},t.cache[i]=i,n.clearTimeout(t.tid),typeof r=="function"&&n.setTimeout(function(){r.call(t,t)},1)};!this.width||!this.height?n.setTimeout(function(e){return function(){e.width&&e.height?s.call(e):Galleria.raise("Could not extract width/height from image: "+e.src+". Traced measures: width:"+e.width+"px, height: "+e.height+"px.")}}(this),2):s.call(this)}}(this,r,t);return o.find("img").remove(),u.css("display","block").appendTo(this.container),N.hide(this.image),this.cache[t]?(e(this.image).load(l).attr("src",t),this.container):(e(this.image).load(l).error(function(){s?f?e(this).attr("src",f):Galleria.raise("Image not found: "+t):(s=!0,n.setTimeout(function(e,t){return function(){e.attr("src",t+"?"+N.timestamp())}}(e(this),t),50))}).attr("src",t),this.container)},scale:function(n){n=e.extend({width:0,height:0,min:t,max:t,margin:0,complete:function(){},position:"center",crop:!1,canvas:!1},n);if(!this.image)return this.container;var r,i,s=this,o=e(s.container),u;return N.wait({until:function(){return r=n.width||o.width()||N.parseValue(o.css("width")),i=n.height||o.height()||N.parseValue(o.css("height")),r&&i},success:function(){var t=(r-n.margin*2)/s.original.width,o=(i-n.margin*2)/s.original.height,a={"true":Math.max(t,o),width:t,height:o,"false":Math.min(t,o)},f=a[n.crop.toString()],l="";n.max&&(f=Math.min(n.max,f)),n.min&&(f=Math.max(n.min,f)),e.each(["width","height"],function(t,n){e(s.image)[n](s[n]=s.image[n]=Math.round(s.original[n]*f))}),e(s.container).width(r).height(i),n.canvas&&S&&(S.elem.width=s.width,S.elem.height=s.height,l=s.image.src+":"+s.width+"x"+s.height,s.image.src=S.cache[l]||function(e){S.context.drawImage(s.image,0,0,s.original.width*f,s.original.height*f);try{return u=S.elem.toDataURL(),S.length+=u.length,S.cache[e]=u,u}catch(t){return s.image.src}}(l));var c={},h={},p=function(t,n,r){var i=0;if(/\%/.test(t)){var o=parseInt(t,10)/100,u=s.image[n]||e(s.image)[n]();i=Math.ceil(u*-1*o+r*o)}else i=N.parseValue(t);return i},d={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};e.each(n.position.toLowerCase().split(" "),function(e,t){t==="center"&&(t="50%"),c[e?"top":"left"]=t}),e.each(c,function(t,n){d.hasOwnProperty(n)&&e.extend(h,d[n])}),c=c.top?e.extend(c,h):h,c=e.extend({top:"50%",left:"50%"},c),e(s.image).css({position:"absolute",top:p(c.top,"height",i),left:p(c.left,"width",r)}),s.show(),s.ready=!0,n.complete.call(s,s)},error:function(){Galleria.raise("Could not scale image: "+s.image.src)},timeout:1e3}),this}},e.extend(e.easing,{galleria:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},galleriaIn:function(e,t,n,r,i){return r*(t/=i)*t+n},galleriaOut:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n}}),e.fn.galleria=function(t){return this.each(function(){e(this).data("galleria",(new Galleria).init(this,t))})}})(jQuery);