(function(){var e,t,n,r,i,s,o;i=function(e,t,n){var r,i,s,o,u,a,f;return r=$(document.createElement("div")).addClass("clear"),a=$(document.createElement("div")).addClass("line-separator left"),o=$(document.createElement("div")),o.attr("title",n),o.addClass("image-container thumb no-padding"),o.append(t),i=$(document.createElement("div")),i.addClass("info-panel left"),f=$(document.createElement("div")),f.addClass("info-line left"),s=$(document.createElement("div")),s.addClass("label text black bold font12"),s.text(n),f.append(s),i.append(f),f=$(document.createElement("div")),f.addClass("progress info-line left"),u=$(document.createElement("div")),u.addClass("uploading"),f.append(u),i.append(f),e.addClass("upload-template container left"),e.append(o),e.append(i),e.append(r),e.append(a),e},r=function(e){var t;return t=$(document.createElement("div")),window.loadImage(e,function(n){return i(t,n,e.name),t.prependTo("#images-panel")},{maxWidth:155,maxHeight:155,canvas:!0}),t},t=function(e){return $("#delete-confirm-popup").modal(),$("#btn-ok").click(function(){return $.modal.close(),window.setTimeout("$('#mask').modal()",500),$.ajax({url:$(e).attr("data-url"),type:"GET",dataType:"json",success:function(e){return e.success?($("#images-panel").html(e.items),$(".pagination-panel").each(function(t,n){return $(n).html(e.pagination)}),$("#gallery_selector_id").html(e.gallery_options),$("select").selectmenu({style:"dropdown"}),helper.show_notification("Delete successfully!")):helper.show_notification(e.msg)},complete:function(){return $.modal.close()}})})},o=function(e){var t,n;return t=[],n=$("#images-panel .edit-template"),n.each(function(e,n){var r;return r=$(n),t.push({id:r.attr("data-id"),name:r.find("#image_name").val(),gallery_id:r.find("#image_gallery_id").val(),price:r.find("#image_price").val(),description:r.find("#image_description").val(),is_album_cover:r.find(".album-cover").is(":checked"),is_avatar:r.find(".user-avatar").is(":checked"),keyword:r.find("#image_key_words").val()})}),$("#mask").modal(),$.ajax({url:"/images/update_images",type:"POST",data:{images:$.toJSON(t),gallery_id:$("#gallery_selector_id").val()},dataType:"json",success:function(t){return $("#images-panel").html(t.items),$(".pagination-panel").each(function(e,n){return $(n).html(t.pagination)}),$("#gallery_selector_id").html(t.gallery_options),$("select").selectmenu({style:"dropdown"}),helper.show_notification("Update successfully!"),e&&e.call(),window.is_grid_changed=!1},error:function(){return helper.show_notification("Fail to update!")},complete:function(){return $.modal.close()}})},e=function(e){return window.is_grid_changed===!0?($("#save-confirm-popup").modal(),$(".button.save-my-changes").click(function(){return o(e)}),$(".button.leave-not-saving").click(function(){return e.call()})):e.call()},s=function(e){var t,n;return n=$(e).closest(".edit-template").attr("data-id"),t=$("#frm-pricing").serialize(),$.modal.close(),window.setTimeout("$('#mask').modal()",300),$.ajax({url:"/images/update_tier?id="+n,type:"POST",data:t,dataType:"json",success:function(t){return t.success?(helper.show_notification("Price has been updated successfully!"),$(e).siblings().text("Tier "+t.tier),$.modal.close()):(helper.show_notification("Something went wrong!"),$("#pricing-form").modal())}})},n=function(e){return $(".price-tab").hide(),$(".price-tab:first").show(),$("ul#tabs li:first a").addClass("active"),$("ul#tabs li").click(function(){var t;return $("ul#tabs li a").removeClass("active"),e=$(this).find("a"),e.addClass("active"),t=e.attr("href"),$(".price-tab").hide(),$(t).show(),!1})},$(function(){return window.is_grid_changed=!1,$("#fileupload").fileupload(),$("#fileupload").fileupload("option",{dataType:"text",maxFileSize:5e6,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,previewMaxWidth:180,previewMaxHeight:180,add:function(e,t){return t.context=r(t.files[0]),t.submit()},done:function(e,t){var n;return n=$.parseJSON(t.result),n.success?($(".empty-data").remove(),$(t.context).replaceWith(n.item),$(".pagination-panel").each(function(e,t){return $(t).html(n.pagination)}),$(".pagination-panel").find(".pagination").length>0&&$("#images-panel").children().last().remove(),$("#gallery_selector_id").html(n.gallery_options),$("select").selectmenu({style:"dropdown"})):$(t.context).find(".progress").replaceWith("<div class='error info-line text italic font12 left'>"+n.msg+"</div>")},progress:function(e,t){var n,r;n=parseInt(t.loaded/t.total*100,10).toString()+"%";if(t.context)return r=function(){return $(t.context).find(".progress .uploading").css("width",n)},window.setTimeout(r,300)},fail:function(e,t){return $(t.context).find(".progress").replaceWith("<div class='error info-line text italic font12 left'>Cannot upload this image right now! Please try again later!</div>")}}),$(".button.save-grid-changes").click(function(){return o()}),$("#images-panel").delegate(".edit-template .album-cover","click",function(e){var t;return t=$("#images-panel .edit-template .album-cover").not(e.target),t.attr("checked",!1)}),$("#images-panel").delegate(".edit-template .user-avatar","click",function(e){var t;return t=$("#images-panel .edit-template .user-avatar").not(e.target),t.attr("checked",!1)}),$("#images-panel").delegate(".button.delete-photo","click",function(e){return t(e.target)}),$("#edit-gallery").click(function(){return $("#edit-gallery-popup").modal()}),$("body").delegate("#btn-gallery-save","click",function(e){return $.ajax({url:$("#frm-edit-gallery").attr("action"),type:"POST",data:$("#frm-edit-gallery").serialize(),dataType:"json",success:function(e){return e.success?(helper.show_notification("Your gallery has been updated!"),$.modal.close(),$("#edit-gallery-popup").replaceWith(e.edit_popup),$("#gallery_selector_id").html(e.gal_with_number_options),$(".edit-template #image_gallery_id").each(function(t,n){return $(n).html(e.gallery_options)}),$("select[id=gallery_permission]").selectmenu({style:"dropdown"})):helper.show_notification(e.msg)}})}),$("#images-panel").delegate(".edit-template input","change",function(e){return window.is_grid_changed=!0}),$("#images-panel").delegate(".edit-template textarea","change",function(e){return window.is_grid_changed=!0}),$("#images-panel").delegate(".edit-template select","change",function(e){return window.is_grid_changed=!0}),$(".pagination-panel").delegate("a","click",function(t){return t.preventDefault(),e(function(){return window.location=$(t.target).attr("href")})}),$(".header-menu ul li > a").click(function(t){return t.preventDefault(),e(function(){return window.location=$(t.target).attr("href")})}),$("#my_links").selectmenu({style:"dropdown",select:function(t,n){return e(function(){return window.location=n.value})}}),$("#gallery_selector_id").change(function(){return e(function(){return $.ajax({url:"edit_images",type:"GET",data:{gallery_id:$("#gallery_selector_id").val()},dataType:"json",success:function(e){return $("#images-panel").html(e.items),$(".pagination-panel").each(function(t,n){return $(n).html(e.pagination)}),$("#delete-gallery").attr("href",e.delete_url),$("#fileupload").attr("action",e.upload_url),$("#edit-gallery-popup").replaceWith(e.edit_popup),$(this).html(e.gallery_options),$("select").selectmenu({style:"dropdown"}),$.modal.close()}})})}),$("#images-panel").delegate(".edit-template .price","click",function(e){var t,r,i,o;return i=e.target,t=$("#pricing-form"),r=e.clientX-60,o=e.clientY-t.height(),$("#pricing-form").modal({opacity:5,position:[o,r],escClose:!1,overlayClose:!0,onOpen:function(r){return r.overlay.fadeIn("slow",function(){return r.container.fadeIn("slow",function(){var u;return r.data.fadeIn(),$("#pricing-form .button").fadeOut(),u=$(i).closest(".edit-template").attr("data-id"),$.ajax({url:"/images/show_pricing",type:"GET",data:{id:u},dataType:"json",success:function(r){return r.success?($("#price-tiers").html(r.price_table),$("#pricing-form .button").fadeIn(),$("#btn-done").click(function(){return s(i)}),n(),o=e.clientY-t.height(),t.closest(".simplemodal-container").css("top",""+o+"px")):($("#price-tiers").html(r.msg),$("#pricing-form .button.close").fadeIn(),o=e.clientY-t.height(),t.closest(".simplemodal-container").css("top",""+o+"px"))}})})})}})})})}).call(this);