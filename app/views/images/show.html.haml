= stylesheet_link_tag("slideshow.css")
= javascript_include_tag("jquery.jcarousel.min.js")

.image.image-browse
  .slideshow-container.clearfix
    .top-container
      .left-container.clearfix.left
        .gallery-container.round-box
          .gallery-image
            .image-content
              = image_tag @selected_image.data.url

        .filter-container
          %ul
            %li
              %input.not-implement{:type => "button", :value => "Filter"}
            %li
              %input.not-implement{:type => "button", :value => "Filter"}
            %li
              %input.not-implement{:type => "button", :value => "Filter"}
            %li
              %input.not-implement{:type => "button", :value => "Filter"}
            %li
              %input.not-implement{:type => "button", :value => "Filter"}

      = simple_form_for(:image, :id => @selected_image, :action => :update, :method => 'put') do |f|
        .right-container.right
          .button-container.round-box.blue-gradient
            %ul
              %li
                %div
                  %input.link-button{:type => "button", 
                                     :value => I18n.t("slideshow.cancel"),
                                     :data => {:href => "/back"}}                  
              %li
                %div
                  %input.not-implement{:type => "button", :value => I18n.t("slideshow.print")}
              %li
                %div
                  = f.submit I18n.t("slideshow.save")

          .edit-area.round-box.clearfix
            = (@selected_image.author ? @selected_image.author.fullname : "")
            %br.clearfix
            %ul
              %li
                = I18n.t("slideshow.picture_name")
              %li
                = f.text_field :name, :value => @selected_image.name
              %li
                = I18n.t("slideshow.description")
              %li
                = f.text_area :description, :value => @selected_image.description

    .bottom-container.clearfix
      %div
        %ul#mycarousel.jcarousel-skin-tango
          - selected_image_position = 1
          - @images.each_with_index do |image, index|
            %li
              - url = url_for(:controller => "images", :action => "show", :id => "#{image.id}")
              %a{:href => "#{url}"}
                - if image.id == @selected_image.id 
                  - selected_image_position = index 
                  = image_tag(image.data.url(:thumb), :size => "70x70", :style => "border: solid 2px orange")
                - else
                  = image_tag(image.data.url(:thumb), :size => "75x75")
:erb
  <script type="text/javascript">
    $(".filter-container").delegate(
      ".not-implement", "click", function() {
        alert("This feature has not been implemented yet.");
        return false;
      }
    );
    $("form .button-container").delegate(
      "input[value!='Save']", "click", function() {
        alert("This feature has not been implemented yet.");
        return false;
      }
    );
  </script>
  <script type="text/javascript">
    function mycarousel_initCallback(carousel)
    {
      // Disable autoscrolling if the user clicks the prev or next button.
      carousel.buttonPrev.bind('click', function() {
          carousel.startAuto(0);
      });

      // Pause autoscrolling if the user moves with the cursor over the clip.
      carousel.clip.hover(function() {
          carousel.stopAuto();
      }, function() {
          carousel.startAuto();
      });
    };

    jQuery(document).ready(function() {
      jQuery('#mycarousel').jcarousel({
          auto: 2,
          start: <%= selected_image_position %>,
          scroll: 3,
          initCallback: mycarousel_initCallback,
          itemFallbackDimension: 180
      });
    });
    
    $(".link-button").click(function(e){
      e.preventDefault();
      if($(this).attr("data-href"))
        window.location = $(this).attr("data-href");
      return false;
    });
  </script>
