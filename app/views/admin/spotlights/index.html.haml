- content_for :head do
  = javascript_include_tag("lib/jail.min.js")
  = javascript_include_tag("app/admin/spotlights.js")
  
= render :partial => "admin/admin_menu"

.admin.spotlights.clearfix
  #top.title-bar.clearfix
    - unless @sort_field.blank?
      %h1.left.title= "#{t('admin.spotlights')} / #{t("admin.sort_field.#{@sort_field}")}"
    - else
      %h1.left.title= "#{t('admin.spotlights')} / #{t("admin.search")}"
    .right
      = render(:partial => "shared/search_box_new", :locals => {:action => search_admin_spotlights_path})
      #search-options
        %span= "Sort By: "
        %span
          = select_tag('sort_field', image_filter_options(@sort_field), :id => 'sort-field-selection')
      
  .content.clearfix
    - @images.each_with_index do |image, idx|
      - image_css = (((idx + 1) % 6) == 0 ? 'no-margin-right' : '')
      .image-container{:id => "image-container-#{image.id}", :class => image_css}        
        - image_link = url_for(:controller => "/images", :action => "browse", :id => "#{image.id}")
        %a.image-link{:href => image_link}
          = async_image_tag(image.data.url(:thumb), :class => "image-thumb image small", :alt => image.name)
          
        .image-info
          - if image.is_promoted?
            .promote-button.button.disabled
          - else
            - promote_link = url_for(:controller => "admin/spotlights", :action => "promote", :id => "#{image.id}")
            .promote-button.button
              %form{:action => promote_link, :class => "promote-photo-form", 
                    :id => "promote-photo-form-#{image.id}", :method=>'post'}
                = hidden_field_tag(:authenticity_token, form_authenticity_token)
            
          .image-name
            %a{:href => image_link, :title => image.name}= truncate(image.name, :length => 20)
          .username
            - author = image.author
            - author_profile = (author ? profile_path(:user_id => author.id) : '#')
            %a{:href => author_profile}= author.try(:username)
          
          .upload-time= "Uploaded #{image.created_at.strftime('%m/%d/%y')}"
          .pageview= pluralize(image.pageview, 'View')
          - permission = image.gallery.try(:permission)
          .permission= (permission.blank? ? "" : permission.titleize)
          
    = render_pagination(@images)
    
    = render(:partial => 'shared/delete_confirm', 
      :layout => 'layouts/popup', 
      :locals => { :title => 'Confirm', :id => 'promote-confirm-popup', 
      :text => t("admin.promote_confirm") })

:erb
  <script>
    jQuery(function() {
      helper.setup_async_image_tag("img.image-thumb");
      spotlights.setup_promote_popup();
      
      // Change selectbox
      $("#sort-field-selection-button").css("width", "160px").css("height", "20px");
      $("#sort-field-selection-button .ui-selectmenu-status").css("padding-top", "3px");
      $("#sort-field-selection-menu").css("width", "160px");
      
      jQuery('#sort-field-selection').change(function(){
        var params = $.url(window.location.href).param();
        params['sort_field'] = $(this).val();
        window.location.search = "?" + jQuery.param(params);        
      });
    })
  </script>
