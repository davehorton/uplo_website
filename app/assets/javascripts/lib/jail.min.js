(function(c){var f=c(window);c.fn.asynchImageLoader=c.fn.jail=function(a){a=c.extend({timeout:10,effect:false,speed:400,selector:null,offset:0,event:"load+scroll",callback:jQuery.noop,callbackAfterEachImage:jQuery.noop,placeholder:false,ignoreHiddenImages:false},a);c.jail.initialStack=this;this.data("triggerEl",a.selector?c(a.selector):f);a.placeholder!==false&&this.each(function(){c(this).attr("src",a.placeholder)});/^load/.test(a.event)?c.asynchImageLoader.later.call(this,a):c.asynchImageLoader.onEvent.call(this,
a,this);return this};c.asynchImageLoader=c.jail={_purgeStack:function(a){for(var b=0;;)if(b===a.length)break;else a[b].getAttribute("data-href")?b++:a.splice(b,1)},_loadOnEvent:function(a){var b=c(this),d=a.data.options,a=a.data.images;c.asynchImageLoader._loadImageIfVisible(d,b);b.unbind(d.event,c.asynchImageLoader._loadOnEvent);c.asynchImageLoader._purgeStack(a);d.callback&&(c.asynchImageLoader._purgeStack(c.jail.initialStack),c.asynchImageLoader._launchCallback(c.jail.initialStack,d))},_bufferedEventListener:function(a){var b=
a.data.images,d=a.data.options,e=b.data("triggerEl");clearTimeout(b.data("poller"));b.data("poller",setTimeout(function(){b.each(function(){c.asynchImageLoader._loadImageIfVisible(d,this,e)});c.asynchImageLoader._purgeStack(b);d.callback&&(c.asynchImageLoader._purgeStack(c.jail.initialStack),c.asynchImageLoader._launchCallback(c.jail.initialStack,d))},d.timeout))},onEvent:function(a,b){b=b||this;if(a.event==="scroll"||a.selector){var d=b.data("triggerEl");b.length>0?(d.bind(a.event,{images:b,options:a},
c.asynchImageLoader._bufferedEventListener),(a.event==="scroll"||!a.selector)&&f.resize({images:b,options:a},c.asynchImageLoader._bufferedEventListener)):d&&d.unbind(a.event,c.asynchImageLoader._bufferedEventListener)}else b.bind(a.event,{options:a,images:b},c.asynchImageLoader._loadOnEvent)},later:function(a){var b=this;a.event==="load"&&b.each(function(){c.asynchImageLoader._loadImageIfVisible(a,this,b.data("triggerEl"))});c.asynchImageLoader._purgeStack(b);c.asynchImageLoader._launchCallback(b,
a);setTimeout(function(){a.event==="load"?b.each(function(){c.asynchImageLoader._loadImage(a,c(this))}):b.each(function(){c.asynchImageLoader._loadImageIfVisible(a,this,b.data("triggerEl"))});c.asynchImageLoader._purgeStack(b);c.asynchImageLoader._launchCallback(b,a);if(a.event==="load+scroll")a.event="scroll",c.asynchImageLoader.onEvent(a,b)},a.timeout)},_launchCallback:function(a,b){if(a.length===0&&!c.jail.isCallback)b.callback.call(this,b),c.jail.isCallback=true},_loadImageIfVisible:function(a,
b,d){var b=c(b),d=/scroll/i.test(a.event)&&d.length>0?d:f,e=true;a.ignoreHiddenImages&&(e=c.jail._isVisibleInOverflownContainer(b,a)&&b.is(":visible"));e&&c.asynchImageLoader._isInTheScreen(d,b,a.offset)&&c.asynchImageLoader._loadImage(a,b)},_isInTheScreen:function(a,b,c){var e=a[0]===window,g=e?{top:0,left:0}:a.offset(),f=g.top+(e?a.scrollTop():0),e=g.left+(e?a.scrollLeft():0),g=e+a.width(),a=f+a.height(),h=b.offset(),i=b.width(),b=b.height();return f-c<=h.top+b&&a+c>=h.top&&e-c<=h.left+i&&g+c>=
h.left},_loadImage:function(a,b){b.hide();b.attr("src",b.attr("data-href"));b.removeAttr("data-href");if(a.effect)if(a.speed)b[a.effect](a.speed);else b[a.effect]();else b.show();a.callbackAfterEachImage.call(this,b,a)},_isVisibleInOverflownContainer:function(a,b){for(var d=a.parent(),e=true;d.get(0).tagName!=="BODY";){if(d.css("overflow")==="hidden"&&!c.jail._isInTheScreen(d,a,b.offset)){e=false;break}if(d.css("visibility")==="hidden"||a.css("visibility")==="hidden"){e=false;break}d=d.parent()}return e}}})(jQuery);